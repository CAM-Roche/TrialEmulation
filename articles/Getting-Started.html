<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting-Started â€¢ RandomisedTrialsEmulation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting-Started">
<meta property="og:description" content="RandomisedTrialsEmulation">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RandomisedTrialsEmulation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Getting-Started.html">Getting-Started</a>
    </li>
    <li>
      <a href="../articles/JSS_Rmd/MyJSSArticle.html">A Capitalized Title: Something about a Package \pkg{foo}</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting-Started</h1>
            
      
      
      <div class="hidden name"><code>Getting-Started.Rmd</code></div>

    </div>

    
    
<p>This package implements methods to analyse a sequence of target trials.</p>
<p>The steps to do this are:</p>
<ol style="list-style-type: decimal">
<li>create the data set with all the required variables</li>
<li>fit models for censoring and calculate weights</li>
<li>expand the data set, with records for each eligible patient for each trial period</li>
<li>fit models for outcomes</li>
</ol>
<p>Some of the functions are inspired by the <a href="https://causalab.sph.harvard.edu/software/" class="external-link">INITIATORS SAS macro</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RandomisedTrialsEmulation</span><span class="op">)</span></span></code></pre></div>
<p>There is an all-in-one function <code>initators()</code> which does all of the steps with one function call.</p>
<p>To get started a longitudinal dataset must be created containing:</p>
<ul>
<li>time period</li>
<li>patient identifier</li>
<li>treatment indicator</li>
<li>outcome indicator</li>
<li>eligibility indicator for trial start in period</li>
<li>other covariates relating to treatment, outcome, or censoring to be used in the models for weights or the outcome</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare the example data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"trial_example"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trial_example</span><span class="op">$</span><span class="va">catvarA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">trial_example</span><span class="op">$</span><span class="va">catvarA</span><span class="op">)</span></span>
<span><span class="va">trial_example</span><span class="op">$</span><span class="va">catvarB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">trial_example</span><span class="op">$</span><span class="va">catvarB</span><span class="op">)</span></span>
<span><span class="va">trial_example</span><span class="op">$</span><span class="va">catvarC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">trial_example</span><span class="op">$</span><span class="va">catvarC</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trial_example</span><span class="op">)</span></span>
<span><span class="co">#&gt;    id eligible period outcome treatment catvarA catvarB catvarC nvarA nvarB</span></span>
<span><span class="co">#&gt; 1 202        1    310       0         0       0       2       0     0    35</span></span>
<span><span class="co">#&gt; 2 202        1    311       0         1       0       2       1     0    42</span></span>
<span><span class="co">#&gt; 3 202        1    312       0         1       0       2       1     0    48</span></span>
<span><span class="co">#&gt; 4 202        1    313       0         1       0       2       1     0    43</span></span>
<span><span class="co">#&gt; 5 202        0    314       0         1       0       2       1     0    45</span></span>
<span><span class="co">#&gt; 6 202        0    315       0         1       0       2       1     0    48</span></span>
<span><span class="co">#&gt;   nvarC</span></span>
<span><span class="co">#&gt; 1    74</span></span>
<span><span class="co">#&gt; 2    74</span></span>
<span><span class="co">#&gt; 3    74</span></span>
<span><span class="co">#&gt; 4    75</span></span>
<span><span class="co">#&gt; 5    75</span></span>
<span><span class="co">#&gt; 6    75</span></span></code></pre></div>
<p>Call the <code><a href="../reference/initiators.html">initiators()</a></code> function to run the complete analysis:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initiators.html">initiators</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">trial_example</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  period <span class="op">=</span> <span class="st">"period"</span>,</span>
<span>  eligible <span class="op">=</span> <span class="st">"eligible"</span>,</span>
<span>  treatment <span class="op">=</span> <span class="st">"treatment"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"outcome"</span>,</span>
<span>  model_var <span class="op">=</span> <span class="st">"assigned_treatment"</span>,</span>
<span>  outcome_cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"catvarA"</span>, <span class="st">"catvarB"</span>, <span class="st">"catvarC"</span>, <span class="st">"nvarA"</span>, <span class="st">"nvarB"</span>, <span class="st">"nvarC"</span><span class="op">)</span>,</span>
<span>  use_censor <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  use_weight <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Start data manipulation"</span></span>
<span><span class="co">#&gt; [1] "Finish data manipulation"</span></span>
<span><span class="co">#&gt; [1] "Processing time of data manipulation:"</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.613   0.012   0.625 </span></span>
<span><span class="co">#&gt; [1] "----------------------------"</span></span>
<span><span class="co">#&gt; [1] "Start data extension"</span></span>
<span><span class="co">#&gt; [1] "Finish data extension"</span></span>
<span><span class="co">#&gt; [1] "Processing time of data extension:"</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   4.763   0.852   5.618 </span></span>
<span><span class="co">#&gt; [1] "----------------------------"</span></span>
<span><span class="co">#&gt; [1] "Number of observations in expanded data: 1939053"</span></span>
<span><span class="co">#&gt; [1] "Base Analysis"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; stats::glm(formula = model_formula, family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = data, weights = data[, weight])</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -0.4504  -0.1069  -0.0879  -0.0680   3.9427  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                      Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)        -3.096e+00  1.457e-01 -21.248  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; assigned_treatment -2.727e-01  4.654e-02  -5.859 4.66e-09 ***</span></span>
<span><span class="co">#&gt; for_period          1.212e-03  6.256e-04   1.937 0.052717 .  </span></span>
<span><span class="co">#&gt; I(for_period^2)     2.063e-06  1.510e-06   1.366 0.171963    </span></span>
<span><span class="co">#&gt; followup_time       2.863e-03  5.204e-04   5.502 3.76e-08 ***</span></span>
<span><span class="co">#&gt; I(followup_time^2) -6.857e-06  2.265e-06  -3.027 0.002469 ** </span></span>
<span><span class="co">#&gt; catvarA1            2.955e-01  2.813e-02  10.505  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; catvarA2            1.385e-01  3.891e-02   3.559 0.000373 ***</span></span>
<span><span class="co">#&gt; catvarA3           -1.104e+01  3.486e+01  -0.317 0.751579    </span></span>
<span><span class="co">#&gt; catvarA7            4.390e-01  3.927e-02  11.180  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; catvarB1           -3.942e-01  1.117e-01  -3.530 0.000416 ***</span></span>
<span><span class="co">#&gt; catvarB2           -4.172e-01  1.155e-01  -3.612 0.000303 ***</span></span>
<span><span class="co">#&gt; catvarB3           -2.417e+00  3.354e-01  -7.206 5.74e-13 ***</span></span>
<span><span class="co">#&gt; catvarB7           -6.952e-01  1.125e-01  -6.181 6.39e-10 ***</span></span>
<span><span class="co">#&gt; catvarC1           -4.905e-02  3.464e-02  -1.416 0.156719    </span></span>
<span><span class="co">#&gt; catvarC2           -6.715e-02  3.558e-02  -1.887 0.059151 .  </span></span>
<span><span class="co">#&gt; catvarC7           -1.186e-01  3.581e-02  -3.312 0.000925 ***</span></span>
<span><span class="co">#&gt; nvarA              -8.404e-02  7.732e-03 -10.870  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; nvarB               5.212e-03  3.199e-04  16.293  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; nvarC              -4.232e-02  8.853e-04 -47.808  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 111015  on 1939052  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 107637  on 1939033  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 107677</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 15</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "-------------------------------------------------"</span></span>
<span><span class="co">#&gt; [1] "Processing time of modeling for base analysis:"</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  37.540   2.623  40.175 </span></span>
<span><span class="co">#&gt; [1] "Base Analysis with robust variance"</span></span>
<span><span class="co">#&gt; [1] "-------------------------------------------------------"</span></span>
<span><span class="co">#&gt; [1] "Robust standard error:"</span></span>
<span><span class="co">#&gt; $summary</span></span>
<span><span class="co">#&gt;                  names      estimate    robust_se            lb            ub</span></span>
<span><span class="co">#&gt;  1:        (Intercept) -3.095941e+00 7.008783e-01 -4.469663e+00 -1.7222196577</span></span>
<span><span class="co">#&gt;  2: assigned_treatment -2.726885e-01 3.087599e-01 -8.778580e-01  0.3324809277</span></span>
<span><span class="co">#&gt;  3:         for_period  1.211873e-03 4.022885e-03 -6.672980e-03  0.0090967269</span></span>
<span><span class="co">#&gt;  4:    I(for_period^2)  2.062562e-06 9.398236e-06 -1.635798e-05  0.0000204831</span></span>
<span><span class="co">#&gt;  5:      followup_time  2.863333e-03 3.399687e-03 -3.800054e-03  0.0095267207</span></span>
<span><span class="co">#&gt;  6: I(followup_time^2) -6.856680e-06 1.625774e-05 -3.872186e-05  0.0000250085</span></span>
<span><span class="co">#&gt;  7:           catvarA1  2.955435e-01 1.906956e-01 -7.821982e-02  0.6693067444</span></span>
<span><span class="co">#&gt;  8:           catvarA2  1.384565e-01 2.811112e-01 -4.125214e-01  0.6894343506</span></span>
<span><span class="co">#&gt;  9:           catvarA3 -1.103529e+01 9.466173e-01 -1.289066e+01 -9.1799179745</span></span>
<span><span class="co">#&gt; 10:           catvarA7  4.390456e-01 2.228737e-01  2.213249e-03  0.8758779928</span></span>
<span><span class="co">#&gt; 11:           catvarB1 -3.941908e-01 3.005267e-01 -9.832230e-01  0.1948414891</span></span>
<span><span class="co">#&gt; 12:           catvarB2 -4.172221e-01 3.637784e-01 -1.130228e+00  0.2957835109</span></span>
<span><span class="co">#&gt; 13:           catvarB3 -2.416999e+00 9.259266e-01 -4.231815e+00 -0.6021830965</span></span>
<span><span class="co">#&gt; 14:           catvarB7 -6.952432e-01 3.056160e-01 -1.294251e+00 -0.0962359411</span></span>
<span><span class="co">#&gt; 15:           catvarC1 -4.905116e-02 1.550408e-01 -3.529311e-01  0.2548288197</span></span>
<span><span class="co">#&gt; 16:           catvarC2 -6.714868e-02 2.269493e-01 -5.119693e-01  0.3776718938</span></span>
<span><span class="co">#&gt; 17:           catvarC7 -1.186201e-01 1.737490e-01 -4.591682e-01  0.2219279198</span></span>
<span><span class="co">#&gt; 18:              nvarA -8.403861e-02 4.502810e-02 -1.722937e-01  0.0042164664</span></span>
<span><span class="co">#&gt; 19:              nvarB  5.211807e-03 2.239120e-03  8.231314e-04  0.0096004830</span></span>
<span><span class="co">#&gt; 20:              nvarC -4.232413e-02 6.709734e-03 -5.547521e-02 -0.0291730526</span></span>
<span><span class="co">#&gt;               z   p_value</span></span>
<span><span class="co">#&gt;  1:  -4.4172306   &lt; 0.001</span></span>
<span><span class="co">#&gt;  2:  -0.8831733 0.3771426</span></span>
<span><span class="co">#&gt;  3:   0.3012449 0.7632278</span></span>
<span><span class="co">#&gt;  4:   0.2194627 0.8262896</span></span>
<span><span class="co">#&gt;  5:   0.8422343 0.3996568</span></span>
<span><span class="co">#&gt;  6:  -0.4217486 0.6732085</span></span>
<span><span class="co">#&gt;  7:   1.5498183 0.1211851</span></span>
<span><span class="co">#&gt;  8:   0.4925328 0.6223428</span></span>
<span><span class="co">#&gt;  9: -11.6576025   &lt; 0.001</span></span>
<span><span class="co">#&gt; 10:   1.9699305 0.0488463</span></span>
<span><span class="co">#&gt; 11:  -1.3116666 0.1896327</span></span>
<span><span class="co">#&gt; 12:  -1.1469129 0.2514176</span></span>
<span><span class="co">#&gt; 13:  -2.6103573 0.0090448</span></span>
<span><span class="co">#&gt; 14:  -2.2748917 0.0229124</span></span>
<span><span class="co">#&gt; 15:  -0.3163758 0.7517173</span></span>
<span><span class="co">#&gt; 16:  -0.2958753 0.7673253</span></span>
<span><span class="co">#&gt; 17:  -0.6827097 0.4947903</span></span>
<span><span class="co">#&gt; 18:  -1.8663592 0.0619911</span></span>
<span><span class="co">#&gt; 19:   2.3276138 0.0199326</span></span>
<span><span class="co">#&gt; 20:  -6.3078703   &lt; 0.001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $matrix</span></span>
<span><span class="co">#&gt;                      (Intercept) assigned_treatment    for_period</span></span>
<span><span class="co">#&gt; (Intercept)         4.912304e-01       2.133315e-02 -1.650603e-03</span></span>
<span><span class="co">#&gt; assigned_treatment  2.133315e-02       9.533269e-02  2.539795e-05</span></span>
<span><span class="co">#&gt; for_period         -1.650603e-03       2.539795e-05  1.618360e-05</span></span>
<span><span class="co">#&gt; I(for_period^2)     2.468702e-06      -2.722270e-07 -3.480661e-08</span></span>
<span><span class="co">#&gt; followup_time      -2.523434e-04      -4.505072e-05 -2.541239e-06</span></span>
<span><span class="co">#&gt; I(followup_time^2) -6.288578e-07       1.671122e-07  1.550655e-08</span></span>
<span><span class="co">#&gt; catvarA1           -2.013034e-03       5.161456e-03 -7.013526e-05</span></span>
<span><span class="co">#&gt; catvarA2           -7.570664e-03       8.941632e-03  2.171781e-05</span></span>
<span><span class="co">#&gt; catvarA3           -8.469025e-03       6.606328e-03 -5.014633e-05</span></span>
<span><span class="co">#&gt; catvarA7           -3.472384e-02       1.226164e-03  2.512661e-04</span></span>
<span><span class="co">#&gt; catvarB1           -8.547994e-02      -1.972117e-02  9.388959e-06</span></span>
<span><span class="co">#&gt; catvarB2           -8.437550e-02      -2.390120e-02 -6.252821e-06</span></span>
<span><span class="co">#&gt; catvarB3           -1.375926e-01      -2.381122e-02  2.897509e-04</span></span>
<span><span class="co">#&gt; catvarB7           -1.148653e-01      -1.938666e-02 -2.514899e-05</span></span>
<span><span class="co">#&gt; catvarC1           -6.523263e-03      -4.683852e-03  4.567174e-05</span></span>
<span><span class="co">#&gt; catvarC2           -6.262368e-03      -9.892785e-03  7.273350e-05</span></span>
<span><span class="co">#&gt; catvarC7           -1.689865e-02      -3.798029e-03  7.566285e-05</span></span>
<span><span class="co">#&gt; nvarA              -2.503240e-03      -1.079340e-03  1.489676e-06</span></span>
<span><span class="co">#&gt; nvarB               1.005118e-04       6.956519e-05 -3.255951e-07</span></span>
<span><span class="co">#&gt; nvarC              -2.495442e-03       9.195632e-06  9.129373e-08</span></span>
<span><span class="co">#&gt;                    I(for_period^2) followup_time I(followup_time^2)</span></span>
<span><span class="co">#&gt; (Intercept)           2.468702e-06 -2.523434e-04      -6.288578e-07</span></span>
<span><span class="co">#&gt; assigned_treatment   -2.722270e-07 -4.505072e-05       1.671122e-07</span></span>
<span><span class="co">#&gt; for_period           -3.480661e-08 -2.541239e-06       1.550655e-08</span></span>
<span><span class="co">#&gt; I(for_period^2)       8.832683e-11  8.632859e-09      -3.931834e-11</span></span>
<span><span class="co">#&gt; followup_time         8.632859e-09  1.155787e-05      -4.974353e-08</span></span>
<span><span class="co">#&gt; I(followup_time^2)   -3.931834e-11 -4.974353e-08       2.643142e-10</span></span>
<span><span class="co">#&gt; catvarA1              1.804082e-07  1.086247e-05       5.598636e-08</span></span>
<span><span class="co">#&gt; catvarA2             -7.000255e-10  4.809334e-05      -1.386547e-07</span></span>
<span><span class="co">#&gt; catvarA3              1.666976e-07 -1.011492e-04       6.607913e-07</span></span>
<span><span class="co">#&gt; catvarA7             -4.360188e-07 -1.378281e-04       8.457448e-07</span></span>
<span><span class="co">#&gt; catvarB1              4.872985e-08  5.805240e-05      -5.166910e-08</span></span>
<span><span class="co">#&gt; catvarB2              8.283618e-08  8.478128e-05      -1.525158e-07</span></span>
<span><span class="co">#&gt; catvarB3             -3.242802e-07 -1.684465e-04       2.264275e-06</span></span>
<span><span class="co">#&gt; catvarB7              4.483527e-07  8.851323e-05      -1.468764e-07</span></span>
<span><span class="co">#&gt; catvarC1             -1.212295e-07 -2.286497e-05       1.103707e-07</span></span>
<span><span class="co">#&gt; catvarC2             -5.939292e-08  3.292384e-05      -8.230454e-08</span></span>
<span><span class="co">#&gt; catvarC7             -7.009011e-08  6.204624e-05      -3.236417e-07</span></span>
<span><span class="co">#&gt; nvarA                 1.052369e-08 -8.184344e-06      -1.869283e-08</span></span>
<span><span class="co">#&gt; nvarB                -1.580027e-09  4.140391e-07      -8.353782e-11</span></span>
<span><span class="co">#&gt; nvarC                -3.720597e-10 -9.626693e-07       9.457246e-09</span></span>
<span><span class="co">#&gt;                         catvarA1      catvarA2      catvarA3      catvarA7</span></span>
<span><span class="co">#&gt; (Intercept)        -2.013034e-03 -7.570664e-03 -8.469025e-03 -3.472384e-02</span></span>
<span><span class="co">#&gt; assigned_treatment  5.161456e-03  8.941632e-03  6.606328e-03  1.226164e-03</span></span>
<span><span class="co">#&gt; for_period         -7.013526e-05  2.171781e-05 -5.014633e-05  2.512661e-04</span></span>
<span><span class="co">#&gt; I(for_period^2)     1.804082e-07 -7.000255e-10  1.666976e-07 -4.360188e-07</span></span>
<span><span class="co">#&gt; followup_time       1.086247e-05  4.809334e-05 -1.011492e-04 -1.378281e-04</span></span>
<span><span class="co">#&gt; I(followup_time^2)  5.598636e-08 -1.386547e-07  6.607913e-07  8.457448e-07</span></span>
<span><span class="co">#&gt; catvarA1            3.636479e-02  2.249641e-02  1.651213e-02  1.245326e-02</span></span>
<span><span class="co">#&gt; catvarA2            2.249641e-02  7.902349e-02  2.095005e-02  1.944261e-02</span></span>
<span><span class="co">#&gt; catvarA3            1.651213e-02  2.095005e-02  8.960843e-01  1.833958e-02</span></span>
<span><span class="co">#&gt; catvarA7            1.245326e-02  1.944261e-02  1.833958e-02  4.967267e-02</span></span>
<span><span class="co">#&gt; catvarB1            5.320977e-03  9.018091e-04  1.763470e-03  2.930741e-03</span></span>
<span><span class="co">#&gt; catvarB2           -6.650647e-05  2.190905e-03  1.668221e-03  4.689679e-03</span></span>
<span><span class="co">#&gt; catvarB3            6.521070e-03  1.167658e-02 -8.807662e-04  1.168239e-02</span></span>
<span><span class="co">#&gt; catvarB7            4.495573e-03  1.681549e-03 -2.088988e-04  2.001096e-03</span></span>
<span><span class="co">#&gt; catvarC1           -6.825177e-04  3.186527e-03  3.343486e-03  3.578828e-03</span></span>
<span><span class="co">#&gt; catvarC2           -9.500613e-03 -6.254333e-03 -5.713215e-04  3.318299e-03</span></span>
<span><span class="co">#&gt; catvarC7            3.573940e-04 -2.964671e-03 -8.380267e-03 -7.032077e-03</span></span>
<span><span class="co">#&gt; nvarA              -3.254099e-04 -1.251915e-04 -1.507685e-04 -1.713090e-04</span></span>
<span><span class="co">#&gt; nvarB              -2.442309e-05 -2.783953e-05  2.156701e-06 -1.125329e-05</span></span>
<span><span class="co">#&gt; nvarC              -2.261187e-04 -3.049820e-04 -6.295492e-05 -1.564047e-04</span></span>
<span><span class="co">#&gt;                         catvarB1      catvarB2      catvarB3      catvarB7</span></span>
<span><span class="co">#&gt; (Intercept)        -8.547994e-02 -8.437550e-02 -1.375926e-01 -1.148653e-01</span></span>
<span><span class="co">#&gt; assigned_treatment -1.972117e-02 -2.390120e-02 -2.381122e-02 -1.938666e-02</span></span>
<span><span class="co">#&gt; for_period          9.388959e-06 -6.252821e-06  2.897509e-04 -2.514899e-05</span></span>
<span><span class="co">#&gt; I(for_period^2)     4.872985e-08  8.283618e-08 -3.242802e-07  4.483527e-07</span></span>
<span><span class="co">#&gt; followup_time       5.805240e-05  8.478128e-05 -1.684465e-04  8.851323e-05</span></span>
<span><span class="co">#&gt; I(followup_time^2) -5.166910e-08 -1.525158e-07  2.264275e-06 -1.468764e-07</span></span>
<span><span class="co">#&gt; catvarA1            5.320977e-03 -6.650647e-05  6.521070e-03  4.495573e-03</span></span>
<span><span class="co">#&gt; catvarA2            9.018091e-04  2.190905e-03  1.167658e-02  1.681549e-03</span></span>
<span><span class="co">#&gt; catvarA3            1.763470e-03  1.668221e-03 -8.807662e-04 -2.088988e-04</span></span>
<span><span class="co">#&gt; catvarA7            2.930741e-03  4.689679e-03  1.168239e-02  2.001096e-03</span></span>
<span><span class="co">#&gt; catvarB1            9.031628e-02  7.686244e-02  9.178450e-02  7.454077e-02</span></span>
<span><span class="co">#&gt; catvarB2            7.686244e-02  1.323347e-01  1.129121e-01  7.774672e-02</span></span>
<span><span class="co">#&gt; catvarB3            9.178450e-02  1.129121e-01  8.573401e-01  9.271548e-02</span></span>
<span><span class="co">#&gt; catvarB7            7.454077e-02  7.774672e-02  9.271548e-02  9.340112e-02</span></span>
<span><span class="co">#&gt; catvarC1            4.818020e-03  6.048891e-03 -7.836063e-03  1.002987e-03</span></span>
<span><span class="co">#&gt; catvarC2            5.757879e-03  1.346724e-02 -1.821655e-02  1.884142e-03</span></span>
<span><span class="co">#&gt; catvarC7           -7.941705e-04 -5.020673e-03  2.508128e-03 -6.010477e-03</span></span>
<span><span class="co">#&gt; nvarA               7.683505e-04  1.832538e-03 -4.460861e-04  1.489380e-03</span></span>
<span><span class="co">#&gt; nvarB              -1.569559e-04 -1.612435e-04 -1.832016e-04 -1.541642e-04</span></span>
<span><span class="co">#&gt; nvarC               1.148795e-04  6.315480e-05  9.700918e-05  2.906402e-04</span></span>
<span><span class="co">#&gt;                         catvarC1      catvarC2      catvarC7         nvarA</span></span>
<span><span class="co">#&gt; (Intercept)        -6.523263e-03 -6.262368e-03 -1.689865e-02 -2.503240e-03</span></span>
<span><span class="co">#&gt; assigned_treatment -4.683852e-03 -9.892785e-03 -3.798029e-03 -1.079340e-03</span></span>
<span><span class="co">#&gt; for_period          4.567174e-05  7.273350e-05  7.566285e-05  1.489676e-06</span></span>
<span><span class="co">#&gt; I(for_period^2)    -1.212295e-07 -5.939292e-08 -7.009011e-08  1.052369e-08</span></span>
<span><span class="co">#&gt; followup_time      -2.286497e-05  3.292384e-05  6.204624e-05 -8.184344e-06</span></span>
<span><span class="co">#&gt; I(followup_time^2)  1.103707e-07 -8.230454e-08 -3.236417e-07 -1.869283e-08</span></span>
<span><span class="co">#&gt; catvarA1           -6.825177e-04 -9.500613e-03  3.573940e-04 -3.254099e-04</span></span>
<span><span class="co">#&gt; catvarA2            3.186527e-03 -6.254333e-03 -2.964671e-03 -1.251915e-04</span></span>
<span><span class="co">#&gt; catvarA3            3.343486e-03 -5.713215e-04 -8.380267e-03 -1.507685e-04</span></span>
<span><span class="co">#&gt; catvarA7            3.578828e-03  3.318299e-03 -7.032077e-03 -1.713090e-04</span></span>
<span><span class="co">#&gt; catvarB1            4.818020e-03  5.757879e-03 -7.941705e-04  7.683505e-04</span></span>
<span><span class="co">#&gt; catvarB2            6.048891e-03  1.346724e-02 -5.020673e-03  1.832538e-03</span></span>
<span><span class="co">#&gt; catvarB3           -7.836063e-03 -1.821655e-02  2.508128e-03 -4.460861e-04</span></span>
<span><span class="co">#&gt; catvarB7            1.002987e-03  1.884142e-03 -6.010477e-03  1.489380e-03</span></span>
<span><span class="co">#&gt; catvarC1            2.403765e-02  1.214420e-02  3.486659e-03  3.184063e-05</span></span>
<span><span class="co">#&gt; catvarC2            1.214420e-02  5.150597e-02  6.864011e-03  7.365315e-04</span></span>
<span><span class="co">#&gt; catvarC7            3.486659e-03  6.864011e-03  3.018872e-02 -3.251291e-04</span></span>
<span><span class="co">#&gt; nvarA               3.184063e-05  7.365315e-04 -3.251291e-04  2.027530e-03</span></span>
<span><span class="co">#&gt; nvarB              -2.940393e-05 -4.669501e-05  3.112137e-05 -3.671632e-05</span></span>
<span><span class="co">#&gt; nvarC              -6.027867e-05 -2.521803e-04 -3.390272e-05  2.045828e-05</span></span>
<span><span class="co">#&gt;                            nvarB         nvarC</span></span>
<span><span class="co">#&gt; (Intercept)         1.005118e-04 -2.495442e-03</span></span>
<span><span class="co">#&gt; assigned_treatment  6.956519e-05  9.195632e-06</span></span>
<span><span class="co">#&gt; for_period         -3.255951e-07  9.129373e-08</span></span>
<span><span class="co">#&gt; I(for_period^2)    -1.580027e-09 -3.720597e-10</span></span>
<span><span class="co">#&gt; followup_time       4.140391e-07 -9.626693e-07</span></span>
<span><span class="co">#&gt; I(followup_time^2) -8.353782e-11  9.457246e-09</span></span>
<span><span class="co">#&gt; catvarA1           -2.442309e-05 -2.261187e-04</span></span>
<span><span class="co">#&gt; catvarA2           -2.783953e-05 -3.049820e-04</span></span>
<span><span class="co">#&gt; catvarA3            2.156701e-06 -6.295492e-05</span></span>
<span><span class="co">#&gt; catvarA7           -1.125329e-05 -1.564047e-04</span></span>
<span><span class="co">#&gt; catvarB1           -1.569559e-04  1.148795e-04</span></span>
<span><span class="co">#&gt; catvarB2           -1.612435e-04  6.315480e-05</span></span>
<span><span class="co">#&gt; catvarB3           -1.832016e-04  9.700918e-05</span></span>
<span><span class="co">#&gt; catvarB7           -1.541642e-04  2.906402e-04</span></span>
<span><span class="co">#&gt; catvarC1           -2.940393e-05 -6.027867e-05</span></span>
<span><span class="co">#&gt; catvarC2           -4.669501e-05 -2.521803e-04</span></span>
<span><span class="co">#&gt; catvarC7            3.112137e-05 -3.390272e-05</span></span>
<span><span class="co">#&gt; nvarA              -3.671632e-05  2.045828e-05</span></span>
<span><span class="co">#&gt; nvarB               5.013660e-06  9.631311e-07</span></span>
<span><span class="co">#&gt; nvarC               9.631311e-07  4.502053e-05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "----------------------------------------------"</span></span>
<span><span class="co">#&gt; [1] "Processing time of getting the output and sandwich with reduced switch data:"</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   2.045   0.312   2.358</span></span></code></pre></div>
<p>By default, this returns the final <code>glm</code> model object and the results using the sandwich estimator.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; stats::glm(formula = model_formula, family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = data, weights = data[, weight])</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -0.4504  -0.1069  -0.0879  -0.0680   3.9427  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                      Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)        -3.096e+00  1.457e-01 -21.248  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; assigned_treatment -2.727e-01  4.654e-02  -5.859 4.66e-09 ***</span></span>
<span><span class="co">#&gt; for_period          1.212e-03  6.256e-04   1.937 0.052717 .  </span></span>
<span><span class="co">#&gt; I(for_period^2)     2.063e-06  1.510e-06   1.366 0.171963    </span></span>
<span><span class="co">#&gt; followup_time       2.863e-03  5.204e-04   5.502 3.76e-08 ***</span></span>
<span><span class="co">#&gt; I(followup_time^2) -6.857e-06  2.265e-06  -3.027 0.002469 ** </span></span>
<span><span class="co">#&gt; catvarA1            2.955e-01  2.813e-02  10.505  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; catvarA2            1.385e-01  3.891e-02   3.559 0.000373 ***</span></span>
<span><span class="co">#&gt; catvarA3           -1.104e+01  3.486e+01  -0.317 0.751579    </span></span>
<span><span class="co">#&gt; catvarA7            4.390e-01  3.927e-02  11.180  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; catvarB1           -3.942e-01  1.117e-01  -3.530 0.000416 ***</span></span>
<span><span class="co">#&gt; catvarB2           -4.172e-01  1.155e-01  -3.612 0.000303 ***</span></span>
<span><span class="co">#&gt; catvarB3           -2.417e+00  3.354e-01  -7.206 5.74e-13 ***</span></span>
<span><span class="co">#&gt; catvarB7           -6.952e-01  1.125e-01  -6.181 6.39e-10 ***</span></span>
<span><span class="co">#&gt; catvarC1           -4.905e-02  3.464e-02  -1.416 0.156719    </span></span>
<span><span class="co">#&gt; catvarC2           -6.715e-02  3.558e-02  -1.887 0.059151 .  </span></span>
<span><span class="co">#&gt; catvarC7           -1.186e-01  3.581e-02  -3.312 0.000925 ***</span></span>
<span><span class="co">#&gt; nvarA              -8.404e-02  7.732e-03 -10.870  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; nvarB               5.212e-03  3.199e-04  16.293  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; nvarC              -4.232e-02  8.853e-04 -47.808  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 111015  on 1939052  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 107637  on 1939033  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 107677</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 15</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span><span class="op">$</span><span class="va">robust</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt;                  names      estimate    robust_se            lb            ub</span></span>
<span><span class="co">#&gt;  1:        (Intercept) -3.095941e+00 7.008783e-01 -4.469663e+00 -1.7222196577</span></span>
<span><span class="co">#&gt;  2: assigned_treatment -2.726885e-01 3.087599e-01 -8.778580e-01  0.3324809277</span></span>
<span><span class="co">#&gt;  3:         for_period  1.211873e-03 4.022885e-03 -6.672980e-03  0.0090967269</span></span>
<span><span class="co">#&gt;  4:    I(for_period^2)  2.062562e-06 9.398236e-06 -1.635798e-05  0.0000204831</span></span>
<span><span class="co">#&gt;  5:      followup_time  2.863333e-03 3.399687e-03 -3.800054e-03  0.0095267207</span></span>
<span><span class="co">#&gt;  6: I(followup_time^2) -6.856680e-06 1.625774e-05 -3.872186e-05  0.0000250085</span></span>
<span><span class="co">#&gt;  7:           catvarA1  2.955435e-01 1.906956e-01 -7.821982e-02  0.6693067444</span></span>
<span><span class="co">#&gt;  8:           catvarA2  1.384565e-01 2.811112e-01 -4.125214e-01  0.6894343506</span></span>
<span><span class="co">#&gt;  9:           catvarA3 -1.103529e+01 9.466173e-01 -1.289066e+01 -9.1799179745</span></span>
<span><span class="co">#&gt; 10:           catvarA7  4.390456e-01 2.228737e-01  2.213249e-03  0.8758779928</span></span>
<span><span class="co">#&gt; 11:           catvarB1 -3.941908e-01 3.005267e-01 -9.832230e-01  0.1948414891</span></span>
<span><span class="co">#&gt; 12:           catvarB2 -4.172221e-01 3.637784e-01 -1.130228e+00  0.2957835109</span></span>
<span><span class="co">#&gt; 13:           catvarB3 -2.416999e+00 9.259266e-01 -4.231815e+00 -0.6021830965</span></span>
<span><span class="co">#&gt; 14:           catvarB7 -6.952432e-01 3.056160e-01 -1.294251e+00 -0.0962359411</span></span>
<span><span class="co">#&gt; 15:           catvarC1 -4.905116e-02 1.550408e-01 -3.529311e-01  0.2548288197</span></span>
<span><span class="co">#&gt; 16:           catvarC2 -6.714868e-02 2.269493e-01 -5.119693e-01  0.3776718938</span></span>
<span><span class="co">#&gt; 17:           catvarC7 -1.186201e-01 1.737490e-01 -4.591682e-01  0.2219279198</span></span>
<span><span class="co">#&gt; 18:              nvarA -8.403861e-02 4.502810e-02 -1.722937e-01  0.0042164664</span></span>
<span><span class="co">#&gt; 19:              nvarB  5.211807e-03 2.239120e-03  8.231314e-04  0.0096004830</span></span>
<span><span class="co">#&gt; 20:              nvarC -4.232413e-02 6.709734e-03 -5.547521e-02 -0.0291730526</span></span>
<span><span class="co">#&gt;               z   p_value</span></span>
<span><span class="co">#&gt;  1:  -4.4172306   &lt; 0.001</span></span>
<span><span class="co">#&gt;  2:  -0.8831733 0.3771426</span></span>
<span><span class="co">#&gt;  3:   0.3012449 0.7632278</span></span>
<span><span class="co">#&gt;  4:   0.2194627 0.8262896</span></span>
<span><span class="co">#&gt;  5:   0.8422343 0.3996568</span></span>
<span><span class="co">#&gt;  6:  -0.4217486 0.6732085</span></span>
<span><span class="co">#&gt;  7:   1.5498183 0.1211851</span></span>
<span><span class="co">#&gt;  8:   0.4925328 0.6223428</span></span>
<span><span class="co">#&gt;  9: -11.6576025   &lt; 0.001</span></span>
<span><span class="co">#&gt; 10:   1.9699305 0.0488463</span></span>
<span><span class="co">#&gt; 11:  -1.3116666 0.1896327</span></span>
<span><span class="co">#&gt; 12:  -1.1469129 0.2514176</span></span>
<span><span class="co">#&gt; 13:  -2.6103573 0.0090448</span></span>
<span><span class="co">#&gt; 14:  -2.2748917 0.0229124</span></span>
<span><span class="co">#&gt; 15:  -0.3163758 0.7517173</span></span>
<span><span class="co">#&gt; 16:  -0.2958753 0.7673253</span></span>
<span><span class="co">#&gt; 17:  -0.6827097 0.4947903</span></span>
<span><span class="co">#&gt; 18:  -1.8663592 0.0619911</span></span>
<span><span class="co">#&gt; 19:   2.3276138 0.0199326</span></span>
<span><span class="co">#&gt; 20:  -6.3078703   &lt; 0.001</span></span></code></pre></div>
<p>Also the sandwich variance-covariance matrix.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span><span class="op">$</span><span class="va">robust</span><span class="op">$</span><span class="va">matrix</span></span>
<span><span class="co">#&gt;                      (Intercept) assigned_treatment    for_period</span></span>
<span><span class="co">#&gt; (Intercept)         4.912304e-01       2.133315e-02 -1.650603e-03</span></span>
<span><span class="co">#&gt; assigned_treatment  2.133315e-02       9.533269e-02  2.539795e-05</span></span>
<span><span class="co">#&gt; for_period         -1.650603e-03       2.539795e-05  1.618360e-05</span></span>
<span><span class="co">#&gt; I(for_period^2)     2.468702e-06      -2.722270e-07 -3.480661e-08</span></span>
<span><span class="co">#&gt; followup_time      -2.523434e-04      -4.505072e-05 -2.541239e-06</span></span>
<span><span class="co">#&gt; I(followup_time^2) -6.288578e-07       1.671122e-07  1.550655e-08</span></span>
<span><span class="co">#&gt; catvarA1           -2.013034e-03       5.161456e-03 -7.013526e-05</span></span>
<span><span class="co">#&gt; catvarA2           -7.570664e-03       8.941632e-03  2.171781e-05</span></span>
<span><span class="co">#&gt; catvarA3           -8.469025e-03       6.606328e-03 -5.014633e-05</span></span>
<span><span class="co">#&gt; catvarA7           -3.472384e-02       1.226164e-03  2.512661e-04</span></span>
<span><span class="co">#&gt; catvarB1           -8.547994e-02      -1.972117e-02  9.388959e-06</span></span>
<span><span class="co">#&gt; catvarB2           -8.437550e-02      -2.390120e-02 -6.252821e-06</span></span>
<span><span class="co">#&gt; catvarB3           -1.375926e-01      -2.381122e-02  2.897509e-04</span></span>
<span><span class="co">#&gt; catvarB7           -1.148653e-01      -1.938666e-02 -2.514899e-05</span></span>
<span><span class="co">#&gt; catvarC1           -6.523263e-03      -4.683852e-03  4.567174e-05</span></span>
<span><span class="co">#&gt; catvarC2           -6.262368e-03      -9.892785e-03  7.273350e-05</span></span>
<span><span class="co">#&gt; catvarC7           -1.689865e-02      -3.798029e-03  7.566285e-05</span></span>
<span><span class="co">#&gt; nvarA              -2.503240e-03      -1.079340e-03  1.489676e-06</span></span>
<span><span class="co">#&gt; nvarB               1.005118e-04       6.956519e-05 -3.255951e-07</span></span>
<span><span class="co">#&gt; nvarC              -2.495442e-03       9.195632e-06  9.129373e-08</span></span>
<span><span class="co">#&gt;                    I(for_period^2) followup_time I(followup_time^2)</span></span>
<span><span class="co">#&gt; (Intercept)           2.468702e-06 -2.523434e-04      -6.288578e-07</span></span>
<span><span class="co">#&gt; assigned_treatment   -2.722270e-07 -4.505072e-05       1.671122e-07</span></span>
<span><span class="co">#&gt; for_period           -3.480661e-08 -2.541239e-06       1.550655e-08</span></span>
<span><span class="co">#&gt; I(for_period^2)       8.832683e-11  8.632859e-09      -3.931834e-11</span></span>
<span><span class="co">#&gt; followup_time         8.632859e-09  1.155787e-05      -4.974353e-08</span></span>
<span><span class="co">#&gt; I(followup_time^2)   -3.931834e-11 -4.974353e-08       2.643142e-10</span></span>
<span><span class="co">#&gt; catvarA1              1.804082e-07  1.086247e-05       5.598636e-08</span></span>
<span><span class="co">#&gt; catvarA2             -7.000255e-10  4.809334e-05      -1.386547e-07</span></span>
<span><span class="co">#&gt; catvarA3              1.666976e-07 -1.011492e-04       6.607913e-07</span></span>
<span><span class="co">#&gt; catvarA7             -4.360188e-07 -1.378281e-04       8.457448e-07</span></span>
<span><span class="co">#&gt; catvarB1              4.872985e-08  5.805240e-05      -5.166910e-08</span></span>
<span><span class="co">#&gt; catvarB2              8.283618e-08  8.478128e-05      -1.525158e-07</span></span>
<span><span class="co">#&gt; catvarB3             -3.242802e-07 -1.684465e-04       2.264275e-06</span></span>
<span><span class="co">#&gt; catvarB7              4.483527e-07  8.851323e-05      -1.468764e-07</span></span>
<span><span class="co">#&gt; catvarC1             -1.212295e-07 -2.286497e-05       1.103707e-07</span></span>
<span><span class="co">#&gt; catvarC2             -5.939292e-08  3.292384e-05      -8.230454e-08</span></span>
<span><span class="co">#&gt; catvarC7             -7.009011e-08  6.204624e-05      -3.236417e-07</span></span>
<span><span class="co">#&gt; nvarA                 1.052369e-08 -8.184344e-06      -1.869283e-08</span></span>
<span><span class="co">#&gt; nvarB                -1.580027e-09  4.140391e-07      -8.353782e-11</span></span>
<span><span class="co">#&gt; nvarC                -3.720597e-10 -9.626693e-07       9.457246e-09</span></span>
<span><span class="co">#&gt;                         catvarA1      catvarA2      catvarA3      catvarA7</span></span>
<span><span class="co">#&gt; (Intercept)        -2.013034e-03 -7.570664e-03 -8.469025e-03 -3.472384e-02</span></span>
<span><span class="co">#&gt; assigned_treatment  5.161456e-03  8.941632e-03  6.606328e-03  1.226164e-03</span></span>
<span><span class="co">#&gt; for_period         -7.013526e-05  2.171781e-05 -5.014633e-05  2.512661e-04</span></span>
<span><span class="co">#&gt; I(for_period^2)     1.804082e-07 -7.000255e-10  1.666976e-07 -4.360188e-07</span></span>
<span><span class="co">#&gt; followup_time       1.086247e-05  4.809334e-05 -1.011492e-04 -1.378281e-04</span></span>
<span><span class="co">#&gt; I(followup_time^2)  5.598636e-08 -1.386547e-07  6.607913e-07  8.457448e-07</span></span>
<span><span class="co">#&gt; catvarA1            3.636479e-02  2.249641e-02  1.651213e-02  1.245326e-02</span></span>
<span><span class="co">#&gt; catvarA2            2.249641e-02  7.902349e-02  2.095005e-02  1.944261e-02</span></span>
<span><span class="co">#&gt; catvarA3            1.651213e-02  2.095005e-02  8.960843e-01  1.833958e-02</span></span>
<span><span class="co">#&gt; catvarA7            1.245326e-02  1.944261e-02  1.833958e-02  4.967267e-02</span></span>
<span><span class="co">#&gt; catvarB1            5.320977e-03  9.018091e-04  1.763470e-03  2.930741e-03</span></span>
<span><span class="co">#&gt; catvarB2           -6.650647e-05  2.190905e-03  1.668221e-03  4.689679e-03</span></span>
<span><span class="co">#&gt; catvarB3            6.521070e-03  1.167658e-02 -8.807662e-04  1.168239e-02</span></span>
<span><span class="co">#&gt; catvarB7            4.495573e-03  1.681549e-03 -2.088988e-04  2.001096e-03</span></span>
<span><span class="co">#&gt; catvarC1           -6.825177e-04  3.186527e-03  3.343486e-03  3.578828e-03</span></span>
<span><span class="co">#&gt; catvarC2           -9.500613e-03 -6.254333e-03 -5.713215e-04  3.318299e-03</span></span>
<span><span class="co">#&gt; catvarC7            3.573940e-04 -2.964671e-03 -8.380267e-03 -7.032077e-03</span></span>
<span><span class="co">#&gt; nvarA              -3.254099e-04 -1.251915e-04 -1.507685e-04 -1.713090e-04</span></span>
<span><span class="co">#&gt; nvarB              -2.442309e-05 -2.783953e-05  2.156701e-06 -1.125329e-05</span></span>
<span><span class="co">#&gt; nvarC              -2.261187e-04 -3.049820e-04 -6.295492e-05 -1.564047e-04</span></span>
<span><span class="co">#&gt;                         catvarB1      catvarB2      catvarB3      catvarB7</span></span>
<span><span class="co">#&gt; (Intercept)        -8.547994e-02 -8.437550e-02 -1.375926e-01 -1.148653e-01</span></span>
<span><span class="co">#&gt; assigned_treatment -1.972117e-02 -2.390120e-02 -2.381122e-02 -1.938666e-02</span></span>
<span><span class="co">#&gt; for_period          9.388959e-06 -6.252821e-06  2.897509e-04 -2.514899e-05</span></span>
<span><span class="co">#&gt; I(for_period^2)     4.872985e-08  8.283618e-08 -3.242802e-07  4.483527e-07</span></span>
<span><span class="co">#&gt; followup_time       5.805240e-05  8.478128e-05 -1.684465e-04  8.851323e-05</span></span>
<span><span class="co">#&gt; I(followup_time^2) -5.166910e-08 -1.525158e-07  2.264275e-06 -1.468764e-07</span></span>
<span><span class="co">#&gt; catvarA1            5.320977e-03 -6.650647e-05  6.521070e-03  4.495573e-03</span></span>
<span><span class="co">#&gt; catvarA2            9.018091e-04  2.190905e-03  1.167658e-02  1.681549e-03</span></span>
<span><span class="co">#&gt; catvarA3            1.763470e-03  1.668221e-03 -8.807662e-04 -2.088988e-04</span></span>
<span><span class="co">#&gt; catvarA7            2.930741e-03  4.689679e-03  1.168239e-02  2.001096e-03</span></span>
<span><span class="co">#&gt; catvarB1            9.031628e-02  7.686244e-02  9.178450e-02  7.454077e-02</span></span>
<span><span class="co">#&gt; catvarB2            7.686244e-02  1.323347e-01  1.129121e-01  7.774672e-02</span></span>
<span><span class="co">#&gt; catvarB3            9.178450e-02  1.129121e-01  8.573401e-01  9.271548e-02</span></span>
<span><span class="co">#&gt; catvarB7            7.454077e-02  7.774672e-02  9.271548e-02  9.340112e-02</span></span>
<span><span class="co">#&gt; catvarC1            4.818020e-03  6.048891e-03 -7.836063e-03  1.002987e-03</span></span>
<span><span class="co">#&gt; catvarC2            5.757879e-03  1.346724e-02 -1.821655e-02  1.884142e-03</span></span>
<span><span class="co">#&gt; catvarC7           -7.941705e-04 -5.020673e-03  2.508128e-03 -6.010477e-03</span></span>
<span><span class="co">#&gt; nvarA               7.683505e-04  1.832538e-03 -4.460861e-04  1.489380e-03</span></span>
<span><span class="co">#&gt; nvarB              -1.569559e-04 -1.612435e-04 -1.832016e-04 -1.541642e-04</span></span>
<span><span class="co">#&gt; nvarC               1.148795e-04  6.315480e-05  9.700918e-05  2.906402e-04</span></span>
<span><span class="co">#&gt;                         catvarC1      catvarC2      catvarC7         nvarA</span></span>
<span><span class="co">#&gt; (Intercept)        -6.523263e-03 -6.262368e-03 -1.689865e-02 -2.503240e-03</span></span>
<span><span class="co">#&gt; assigned_treatment -4.683852e-03 -9.892785e-03 -3.798029e-03 -1.079340e-03</span></span>
<span><span class="co">#&gt; for_period          4.567174e-05  7.273350e-05  7.566285e-05  1.489676e-06</span></span>
<span><span class="co">#&gt; I(for_period^2)    -1.212295e-07 -5.939292e-08 -7.009011e-08  1.052369e-08</span></span>
<span><span class="co">#&gt; followup_time      -2.286497e-05  3.292384e-05  6.204624e-05 -8.184344e-06</span></span>
<span><span class="co">#&gt; I(followup_time^2)  1.103707e-07 -8.230454e-08 -3.236417e-07 -1.869283e-08</span></span>
<span><span class="co">#&gt; catvarA1           -6.825177e-04 -9.500613e-03  3.573940e-04 -3.254099e-04</span></span>
<span><span class="co">#&gt; catvarA2            3.186527e-03 -6.254333e-03 -2.964671e-03 -1.251915e-04</span></span>
<span><span class="co">#&gt; catvarA3            3.343486e-03 -5.713215e-04 -8.380267e-03 -1.507685e-04</span></span>
<span><span class="co">#&gt; catvarA7            3.578828e-03  3.318299e-03 -7.032077e-03 -1.713090e-04</span></span>
<span><span class="co">#&gt; catvarB1            4.818020e-03  5.757879e-03 -7.941705e-04  7.683505e-04</span></span>
<span><span class="co">#&gt; catvarB2            6.048891e-03  1.346724e-02 -5.020673e-03  1.832538e-03</span></span>
<span><span class="co">#&gt; catvarB3           -7.836063e-03 -1.821655e-02  2.508128e-03 -4.460861e-04</span></span>
<span><span class="co">#&gt; catvarB7            1.002987e-03  1.884142e-03 -6.010477e-03  1.489380e-03</span></span>
<span><span class="co">#&gt; catvarC1            2.403765e-02  1.214420e-02  3.486659e-03  3.184063e-05</span></span>
<span><span class="co">#&gt; catvarC2            1.214420e-02  5.150597e-02  6.864011e-03  7.365315e-04</span></span>
<span><span class="co">#&gt; catvarC7            3.486659e-03  6.864011e-03  3.018872e-02 -3.251291e-04</span></span>
<span><span class="co">#&gt; nvarA               3.184063e-05  7.365315e-04 -3.251291e-04  2.027530e-03</span></span>
<span><span class="co">#&gt; nvarB              -2.940393e-05 -4.669501e-05  3.112137e-05 -3.671632e-05</span></span>
<span><span class="co">#&gt; nvarC              -6.027867e-05 -2.521803e-04 -3.390272e-05  2.045828e-05</span></span>
<span><span class="co">#&gt;                            nvarB         nvarC</span></span>
<span><span class="co">#&gt; (Intercept)         1.005118e-04 -2.495442e-03</span></span>
<span><span class="co">#&gt; assigned_treatment  6.956519e-05  9.195632e-06</span></span>
<span><span class="co">#&gt; for_period         -3.255951e-07  9.129373e-08</span></span>
<span><span class="co">#&gt; I(for_period^2)    -1.580027e-09 -3.720597e-10</span></span>
<span><span class="co">#&gt; followup_time       4.140391e-07 -9.626693e-07</span></span>
<span><span class="co">#&gt; I(followup_time^2) -8.353782e-11  9.457246e-09</span></span>
<span><span class="co">#&gt; catvarA1           -2.442309e-05 -2.261187e-04</span></span>
<span><span class="co">#&gt; catvarA2           -2.783953e-05 -3.049820e-04</span></span>
<span><span class="co">#&gt; catvarA3            2.156701e-06 -6.295492e-05</span></span>
<span><span class="co">#&gt; catvarA7           -1.125329e-05 -1.564047e-04</span></span>
<span><span class="co">#&gt; catvarB1           -1.569559e-04  1.148795e-04</span></span>
<span><span class="co">#&gt; catvarB2           -1.612435e-04  6.315480e-05</span></span>
<span><span class="co">#&gt; catvarB3           -1.832016e-04  9.700918e-05</span></span>
<span><span class="co">#&gt; catvarB7           -1.541642e-04  2.906402e-04</span></span>
<span><span class="co">#&gt; catvarC1           -2.940393e-05 -6.027867e-05</span></span>
<span><span class="co">#&gt; catvarC2           -4.669501e-05 -2.521803e-04</span></span>
<span><span class="co">#&gt; catvarC7            3.112137e-05 -3.390272e-05</span></span>
<span><span class="co">#&gt; nvarA              -3.671632e-05  2.045828e-05</span></span>
<span><span class="co">#&gt; nvarB               5.013660e-06  9.631311e-07</span></span>
<span><span class="co">#&gt; nvarC               9.631311e-07  4.502053e-05</span></span></code></pre></div>
<div class="section level2">
<h2 id="flexible-analysis">Flexible Analysis<a class="anchor" aria-label="anchor" href="#flexible-analysis"></a>
</h2>
<p>To gain complete control over the analysis and to inspect the intermediate objects, it can be useful to run the the data preparation and modelling steps separately.</p>
<p>This also allows for processing of very large data sets, by doing the data preparation in chunks and then sampling from the expanded trial data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for the purposes of the vignette, we use a temporary directory, however it may be useful to use a permanent location</span></span>
<span><span class="co"># in order to inspect the outputs later</span></span>
<span><span class="va">working_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"trial_emu"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">working_dir</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">working_dir</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prep_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_preparation.html">data_preparation</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">trial_example</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  period <span class="op">=</span> <span class="st">"period"</span>,</span>
<span>  eligible <span class="op">=</span> <span class="st">"eligible"</span>,</span>
<span>  treatment <span class="op">=</span> <span class="st">"treatment"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"outcome"</span>,</span>
<span>  model_var <span class="op">=</span> <span class="st">"assigned_treatment"</span>,</span>
<span>  outcome_cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"catvarA"</span>, <span class="st">"catvarB"</span>, <span class="st">"catvarC"</span>, <span class="st">"nvarA"</span>, <span class="st">"nvarB"</span>, <span class="st">"nvarC"</span><span class="op">)</span>,</span>
<span>  numCores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="va">working_dir</span>,</span>
<span>  use_censor <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  use_weight <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  separate_files <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  switch_n_cov <span class="op">=</span> <span class="op">~</span> <span class="va">nvarA</span> <span class="op">+</span> <span class="va">nvarB</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Start data manipulation"</span></span>
<span><span class="co">#&gt; [1] "Finish data manipulation"</span></span>
<span><span class="co">#&gt; [1] "Processing time of data manipulation:"</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;    0.63    0.00    0.63 </span></span>
<span><span class="co">#&gt; [1] "----------------------------"</span></span>
<span><span class="co">#&gt; [1] "P(treatment=1 | treatment=0) for denominator"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = as.formula(formula), family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = data, control = parglm::parglm.control(nthreads = 4, </span></span>
<span><span class="co">#&gt;         method = "FAST"), method = parglm::parglm.fit, singular.ok = FALSE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -0.2059  -0.2059  -0.2059  -0.2059   2.7801  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) -3.84325    0.04785  -80.31   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 4329.7  on 21263  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 4329.7  on 21263  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 4331.7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "P(treatment=1 | treatment=0) for numerator"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = as.formula(formula), family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = data, control = parglm::parglm.control(nthreads = 4, </span></span>
<span><span class="co">#&gt;         method = "FAST"), method = parglm::parglm.fit, singular.ok = FALSE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -0.2154  -0.2076  -0.2065  -0.2048   2.8246  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) -3.8203716  0.0679254 -56.244   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; nvarA        0.0041081  0.0294330   0.140    0.889    </span></span>
<span><span class="co">#&gt; nvarB       -0.0006602  0.0012963  -0.509    0.611    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 4329.7  on 21263  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 4329.4  on 21261  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 4335.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "P(treatment=1 | treatment=1) for denominator"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = as.formula(formula), family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = data, control = parglm::parglm.control(nthreads = 4, </span></span>
<span><span class="co">#&gt;         method = "FAST"), method = parglm::parglm.fit, singular.ok = FALSE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -2.9627   0.1581   0.1581   0.1581   0.1581  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)  4.37616    0.06815   64.21   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 2346.7  on 17555  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 2346.7  on 17555  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 2348.7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "P(treatment=1 | treatment=1) for numerator"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = as.formula(formula), family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = data, control = parglm::parglm.control(nthreads = 4, </span></span>
<span><span class="co">#&gt;         method = "FAST"), method = parglm::parglm.fit, singular.ok = FALSE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -3.3191   0.1455   0.1609   0.1711   0.1884  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)  4.022249   0.116756  34.450  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; nvarA       -0.002263   0.044029  -0.051  0.95901    </span></span>
<span><span class="co">#&gt; nvarB        0.007584   0.002306   3.289  0.00101 ** </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 2346.7  on 17555  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 2333.3  on 17553  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 2339.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "Start data extension"</span></span>
<span><span class="co">#&gt; [1] "Finish data extension"</span></span>
<span><span class="co">#&gt; [1] "Processing time of data extension:"</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   4.354   0.312   4.668 </span></span>
<span><span class="co">#&gt; [1] "----------------------------"</span></span>
<span><span class="co">#&gt; [1] "Number of observations in expanded data: 961772"</span></span></code></pre></div>
<p>We can access the summaries of the weight models to inspect how the IP weights have been calculated.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working_dir</span>, <span class="st">"weight_models.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">weight_models</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 8</span></span>
<span><span class="co">#&gt;  $ switch_d0           : tibble [1 Ã— 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ switch_d0_statistics: tibble [1 Ã— 8] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ switch_n0           : tibble [3 Ã— 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ switch_n0_statistics: tibble [1 Ã— 8] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ switch_d1           : tibble [1 Ã— 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ switch_statistics   : tibble [1 Ã— 8] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ switch_n1           : tibble [3 Ã— 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ switch_n1_statistics: tibble [1 Ã— 8] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="va">weight_models</span><span class="op">$</span><span class="va">switch_n0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 Ã— 5</span></span></span>
<span><span class="co">#&gt;   term         estimate std.error statistic p.value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (Intercept) -<span style="color: #BB0000;">3.82</span>       0.067<span style="text-decoration: underline;">9</span>    -<span style="color: #BB0000;">56.2</span>     0    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> nvarA        0.004<span style="text-decoration: underline;">11</span>    0.029<span style="text-decoration: underline;">4</span>      0.140   0.889</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> nvarB       -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">660</span>   0.001<span style="text-decoration: underline;">30</span>    -<span style="color: #BB0000;">0.509</span>   0.611</span></span>
<span><span class="va">weight_models</span><span class="op">$</span><span class="va">switch_n0_statistics</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 Ã— 8</span></span></span>
<span><span class="co">#&gt;   null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs</span></span>
<span><span class="co">#&gt;           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         <span style="text-decoration: underline;">4</span>330.   <span style="text-decoration: underline;">21</span>263 -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">165.</span> <span style="text-decoration: underline;">4</span>335. <span style="text-decoration: underline;">4</span>359.    <span style="text-decoration: underline;">4</span>329.       <span style="text-decoration: underline;">21</span>261 <span style="text-decoration: underline;">21</span>264</span></span></code></pre></div>
<p>Here we see the expanded trial files:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">working_dir</span>, pattern <span class="op">=</span> <span class="st">"trial_"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   [1] "trial_1.csv"   "trial_10.csv"  "trial_100.csv" "trial_101.csv"</span></span>
<span><span class="co">#&gt;   [5] "trial_102.csv" "trial_103.csv" "trial_104.csv" "trial_105.csv"</span></span>
<span><span class="co">#&gt;   [9] "trial_106.csv" "trial_107.csv" "trial_108.csv" "trial_109.csv"</span></span>
<span><span class="co">#&gt;  [13] "trial_11.csv"  "trial_110.csv" "trial_111.csv" "trial_112.csv"</span></span>
<span><span class="co">#&gt;  [17] "trial_113.csv" "trial_114.csv" "trial_115.csv" "trial_116.csv"</span></span>
<span><span class="co">#&gt;  [21] "trial_117.csv" "trial_118.csv" "trial_119.csv" "trial_12.csv" </span></span>
<span><span class="co">#&gt;  [25] "trial_120.csv" "trial_121.csv" "trial_122.csv" "trial_123.csv"</span></span>
<span><span class="co">#&gt;  [29] "trial_124.csv" "trial_125.csv" "trial_126.csv" "trial_127.csv"</span></span>
<span><span class="co">#&gt;  [33] "trial_128.csv" "trial_129.csv" "trial_13.csv"  "trial_130.csv"</span></span>
<span><span class="co">#&gt;  [37] "trial_131.csv" "trial_132.csv" "trial_133.csv" "trial_134.csv"</span></span>
<span><span class="co">#&gt;  [41] "trial_135.csv" "trial_136.csv" "trial_137.csv" "trial_138.csv"</span></span>
<span><span class="co">#&gt;  [45] "trial_139.csv" "trial_14.csv"  "trial_140.csv" "trial_141.csv"</span></span>
<span><span class="co">#&gt;  [49] "trial_142.csv" "trial_143.csv" "trial_144.csv" "trial_145.csv"</span></span>
<span><span class="co">#&gt;  [53] "trial_146.csv" "trial_147.csv" "trial_148.csv" "trial_149.csv"</span></span>
<span><span class="co">#&gt;  [57] "trial_15.csv"  "trial_150.csv" "trial_151.csv" "trial_152.csv"</span></span>
<span><span class="co">#&gt;  [61] "trial_153.csv" "trial_154.csv" "trial_155.csv" "trial_156.csv"</span></span>
<span><span class="co">#&gt;  [65] "trial_157.csv" "trial_158.csv" "trial_159.csv" "trial_16.csv" </span></span>
<span><span class="co">#&gt;  [69] "trial_160.csv" "trial_161.csv" "trial_162.csv" "trial_163.csv"</span></span>
<span><span class="co">#&gt;  [73] "trial_164.csv" "trial_165.csv" "trial_166.csv" "trial_167.csv"</span></span>
<span><span class="co">#&gt;  [77] "trial_168.csv" "trial_169.csv" "trial_17.csv"  "trial_170.csv"</span></span>
<span><span class="co">#&gt;  [81] "trial_171.csv" "trial_172.csv" "trial_173.csv" "trial_174.csv"</span></span>
<span><span class="co">#&gt;  [85] "trial_175.csv" "trial_176.csv" "trial_177.csv" "trial_178.csv"</span></span>
<span><span class="co">#&gt;  [89] "trial_179.csv" "trial_18.csv"  "trial_180.csv" "trial_181.csv"</span></span>
<span><span class="co">#&gt;  [93] "trial_182.csv" "trial_183.csv" "trial_184.csv" "trial_185.csv"</span></span>
<span><span class="co">#&gt;  [97] "trial_186.csv" "trial_187.csv" "trial_188.csv" "trial_189.csv"</span></span>
<span><span class="co">#&gt; [101] "trial_19.csv"  "trial_190.csv" "trial_191.csv" "trial_192.csv"</span></span>
<span><span class="co">#&gt; [105] "trial_193.csv" "trial_194.csv" "trial_195.csv" "trial_196.csv"</span></span>
<span><span class="co">#&gt; [109] "trial_197.csv" "trial_198.csv" "trial_199.csv" "trial_2.csv"  </span></span>
<span><span class="co">#&gt; [113] "trial_20.csv"  "trial_200.csv" "trial_201.csv" "trial_202.csv"</span></span>
<span><span class="co">#&gt; [117] "trial_203.csv" "trial_204.csv" "trial_205.csv" "trial_206.csv"</span></span>
<span><span class="co">#&gt; [121] "trial_207.csv" "trial_208.csv" "trial_209.csv" "trial_21.csv" </span></span>
<span><span class="co">#&gt; [125] "trial_210.csv" "trial_211.csv" "trial_212.csv" "trial_213.csv"</span></span>
<span><span class="co">#&gt; [129] "trial_214.csv" "trial_215.csv" "trial_216.csv" "trial_217.csv"</span></span>
<span><span class="co">#&gt; [133] "trial_218.csv" "trial_219.csv" "trial_22.csv"  "trial_220.csv"</span></span>
<span><span class="co">#&gt; [137] "trial_221.csv" "trial_222.csv" "trial_223.csv" "trial_224.csv"</span></span>
<span><span class="co">#&gt; [141] "trial_225.csv" "trial_226.csv" "trial_227.csv" "trial_228.csv"</span></span>
<span><span class="co">#&gt; [145] "trial_229.csv" "trial_23.csv"  "trial_230.csv" "trial_231.csv"</span></span>
<span><span class="co">#&gt; [149] "trial_232.csv" "trial_233.csv" "trial_234.csv" "trial_235.csv"</span></span>
<span><span class="co">#&gt; [153] "trial_236.csv" "trial_237.csv" "trial_238.csv" "trial_239.csv"</span></span>
<span><span class="co">#&gt; [157] "trial_24.csv"  "trial_240.csv" "trial_241.csv" "trial_242.csv"</span></span>
<span><span class="co">#&gt; [161] "trial_243.csv" "trial_244.csv" "trial_245.csv" "trial_246.csv"</span></span>
<span><span class="co">#&gt; [165] "trial_247.csv" "trial_248.csv" "trial_249.csv" "trial_25.csv" </span></span>
<span><span class="co">#&gt; [169] "trial_250.csv" "trial_251.csv" "trial_252.csv" "trial_253.csv"</span></span>
<span><span class="co">#&gt; [173] "trial_254.csv" "trial_255.csv" "trial_256.csv" "trial_257.csv"</span></span>
<span><span class="co">#&gt; [177] "trial_258.csv" "trial_259.csv" "trial_26.csv"  "trial_260.csv"</span></span>
<span><span class="co">#&gt; [181] "trial_261.csv" "trial_262.csv" "trial_263.csv" "trial_264.csv"</span></span>
<span><span class="co">#&gt; [185] "trial_265.csv" "trial_266.csv" "trial_267.csv" "trial_268.csv"</span></span>
<span><span class="co">#&gt; [189] "trial_269.csv" "trial_27.csv"  "trial_270.csv" "trial_271.csv"</span></span>
<span><span class="co">#&gt; [193] "trial_272.csv" "trial_273.csv" "trial_274.csv" "trial_275.csv"</span></span>
<span><span class="co">#&gt; [197] "trial_276.csv" "trial_277.csv" "trial_278.csv" "trial_279.csv"</span></span>
<span><span class="co">#&gt; [201] "trial_28.csv"  "trial_280.csv" "trial_281.csv" "trial_282.csv"</span></span>
<span><span class="co">#&gt; [205] "trial_283.csv" "trial_284.csv" "trial_285.csv" "trial_286.csv"</span></span>
<span><span class="co">#&gt; [209] "trial_287.csv" "trial_288.csv" "trial_289.csv" "trial_29.csv" </span></span>
<span><span class="co">#&gt; [213] "trial_290.csv" "trial_291.csv" "trial_292.csv" "trial_293.csv"</span></span>
<span><span class="co">#&gt; [217] "trial_294.csv" "trial_295.csv" "trial_296.csv" "trial_297.csv"</span></span>
<span><span class="co">#&gt; [221] "trial_298.csv" "trial_299.csv" "trial_3.csv"   "trial_30.csv" </span></span>
<span><span class="co">#&gt; [225] "trial_300.csv" "trial_301.csv" "trial_302.csv" "trial_303.csv"</span></span>
<span><span class="co">#&gt; [229] "trial_304.csv" "trial_305.csv" "trial_306.csv" "trial_307.csv"</span></span>
<span><span class="co">#&gt; [233] "trial_308.csv" "trial_309.csv" "trial_31.csv"  "trial_310.csv"</span></span>
<span><span class="co">#&gt; [237] "trial_311.csv" "trial_312.csv" "trial_313.csv" "trial_314.csv"</span></span>
<span><span class="co">#&gt; [241] "trial_315.csv" "trial_316.csv" "trial_317.csv" "trial_318.csv"</span></span>
<span><span class="co">#&gt; [245] "trial_319.csv" "trial_32.csv"  "trial_320.csv" "trial_321.csv"</span></span>
<span><span class="co">#&gt; [249] "trial_322.csv" "trial_323.csv" "trial_324.csv" "trial_325.csv"</span></span>
<span><span class="co">#&gt; [253] "trial_326.csv" "trial_327.csv" "trial_328.csv" "trial_329.csv"</span></span>
<span><span class="co">#&gt; [257] "trial_33.csv"  "trial_330.csv" "trial_331.csv" "trial_332.csv"</span></span>
<span><span class="co">#&gt; [261] "trial_333.csv" "trial_334.csv" "trial_335.csv" "trial_336.csv"</span></span>
<span><span class="co">#&gt; [265] "trial_337.csv" "trial_338.csv" "trial_339.csv" "trial_34.csv" </span></span>
<span><span class="co">#&gt; [269] "trial_340.csv" "trial_341.csv" "trial_342.csv" "trial_343.csv"</span></span>
<span><span class="co">#&gt; [273] "trial_344.csv" "trial_345.csv" "trial_346.csv" "trial_347.csv"</span></span>
<span><span class="co">#&gt; [277] "trial_348.csv" "trial_349.csv" "trial_35.csv"  "trial_350.csv"</span></span>
<span><span class="co">#&gt; [281] "trial_351.csv" "trial_352.csv" "trial_353.csv" "trial_354.csv"</span></span>
<span><span class="co">#&gt; [285] "trial_355.csv" "trial_356.csv" "trial_357.csv" "trial_358.csv"</span></span>
<span><span class="co">#&gt; [289] "trial_359.csv" "trial_36.csv"  "trial_360.csv" "trial_361.csv"</span></span>
<span><span class="co">#&gt; [293] "trial_362.csv" "trial_363.csv" "trial_364.csv" "trial_365.csv"</span></span>
<span><span class="co">#&gt; [297] "trial_366.csv" "trial_367.csv" "trial_368.csv" "trial_369.csv"</span></span>
<span><span class="co">#&gt; [301] "trial_37.csv"  "trial_370.csv" "trial_371.csv" "trial_372.csv"</span></span>
<span><span class="co">#&gt; [305] "trial_373.csv" "trial_374.csv" "trial_375.csv" "trial_376.csv"</span></span>
<span><span class="co">#&gt; [309] "trial_377.csv" "trial_378.csv" "trial_379.csv" "trial_38.csv" </span></span>
<span><span class="co">#&gt; [313] "trial_380.csv" "trial_381.csv" "trial_382.csv" "trial_383.csv"</span></span>
<span><span class="co">#&gt; [317] "trial_384.csv" "trial_385.csv" "trial_386.csv" "trial_387.csv"</span></span>
<span><span class="co">#&gt; [321] "trial_388.csv" "trial_389.csv" "trial_39.csv"  "trial_390.csv"</span></span>
<span><span class="co">#&gt; [325] "trial_391.csv" "trial_392.csv" "trial_393.csv" "trial_394.csv"</span></span>
<span><span class="co">#&gt; [329] "trial_395.csv" "trial_396.csv" "trial_4.csv"   "trial_40.csv" </span></span>
<span><span class="co">#&gt; [333] "trial_41.csv"  "trial_42.csv"  "trial_43.csv"  "trial_44.csv" </span></span>
<span><span class="co">#&gt; [337] "trial_45.csv"  "trial_46.csv"  "trial_47.csv"  "trial_48.csv" </span></span>
<span><span class="co">#&gt; [341] "trial_49.csv"  "trial_5.csv"   "trial_50.csv"  "trial_51.csv" </span></span>
<span><span class="co">#&gt; [345] "trial_52.csv"  "trial_53.csv"  "trial_54.csv"  "trial_55.csv" </span></span>
<span><span class="co">#&gt; [349] "trial_56.csv"  "trial_57.csv"  "trial_58.csv"  "trial_59.csv" </span></span>
<span><span class="co">#&gt; [353] "trial_6.csv"   "trial_60.csv"  "trial_61.csv"  "trial_62.csv" </span></span>
<span><span class="co">#&gt; [357] "trial_63.csv"  "trial_64.csv"  "trial_65.csv"  "trial_66.csv" </span></span>
<span><span class="co">#&gt; [361] "trial_67.csv"  "trial_68.csv"  "trial_69.csv"  "trial_7.csv"  </span></span>
<span><span class="co">#&gt; [365] "trial_70.csv"  "trial_71.csv"  "trial_72.csv"  "trial_73.csv" </span></span>
<span><span class="co">#&gt; [369] "trial_74.csv"  "trial_75.csv"  "trial_76.csv"  "trial_77.csv" </span></span>
<span><span class="co">#&gt; [373] "trial_78.csv"  "trial_79.csv"  "trial_8.csv"   "trial_80.csv" </span></span>
<span><span class="co">#&gt; [377] "trial_81.csv"  "trial_82.csv"  "trial_83.csv"  "trial_84.csv" </span></span>
<span><span class="co">#&gt; [381] "trial_85.csv"  "trial_86.csv"  "trial_87.csv"  "trial_88.csv" </span></span>
<span><span class="co">#&gt; [385] "trial_89.csv"  "trial_9.csv"   "trial_90.csv"  "trial_91.csv" </span></span>
<span><span class="co">#&gt; [389] "trial_92.csv"  "trial_93.csv"  "trial_94.csv"  "trial_95.csv" </span></span>
<span><span class="co">#&gt; [393] "trial_96.csv"  "trial_97.csv"  "trial_98.csv"  "trial_99.csv"</span></span></code></pre></div>
<p>Each of these csv files contains the data for the trial starting at period <code>_i</code>. To create a manageable dataset for the final analysis we can sample from these trials.</p>
<p>Here we sample 10% of the patients at each follow-up time in each trial without an event. All observations with events are included.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampled_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/case_control_sampling_trials.html">case_control_sampling_trials</a></span><span class="op">(</span><span class="va">prep_data</span>, p_control <span class="op">=</span> <span class="fl">0.1</span>, sample_all_periods <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sampled_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classes 'data.table' and 'data.frame':   132349 obs. of  14 variables:</span></span>
<span><span class="co">#&gt;  $ id                : int  54 140 484 358 176 31 423 423 165 140 ...</span></span>
<span><span class="co">#&gt;  $ for_period        : int  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ followup_time     : int  0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;  $ outcome           : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ weight            : num  1 1 0.999 0.999 0.998 ...</span></span>
<span><span class="co">#&gt;  $ treatment         : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ catvarA           : Factor w/ 5 levels "0","1","2","3",..: 5 5 5 5 5 5 5 5 5 5 ...</span></span>
<span><span class="co">#&gt;  $ catvarB           : Factor w/ 5 levels "0","1","2","3",..: 5 5 5 5 5 5 5 5 5 5 ...</span></span>
<span><span class="co">#&gt;  $ catvarC           : Factor w/ 4 levels "0","1","2","7": 4 4 4 4 4 4 4 4 4 4 ...</span></span>
<span><span class="co">#&gt;  $ nvarA             : int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ nvarB             : int  0 0 1 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ nvarC             : int  49 46 55 47 45 40 56 56 70 46 ...</span></span>
<span><span class="co">#&gt;  $ assigned_treatment: int  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sample_weight     : num  10 10 10 10 10 10 10 10 10 10 ...</span></span>
<span><span class="co">#&gt;  - attr(*, ".internal.selfref")=&lt;externalptr&gt;</span></span></code></pre></div>
<p>Before proceeding with the modelling, it is possible to manipulate and derive new variables and adjust factor levels in the <code>data.frame</code>. You can also specify transformations in a formula to <code>outcome_cov</code>, <code>include_followup_time_case</code> or <code>include_expansion_time_case</code>, such as <code>~ ns(for_period)</code> or <code>~ I(nvarA^2) + nvarC &gt; 50 + catvarA:nvarC</code>.</p>
<p>It is also possible to specify formulas in <code>data_modelling</code> to include, for example, splines with <code>ns()</code>.</p>
<p>Now we can fit the model with the <code><a href="../reference/data_modelling.html">data_modelling()</a></code> function. Since we have sampled from the data, we should make use of the <code>use_sample_weights</code> option to get correct survival estimates.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_modelling.html">data_modelling</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sampled_data</span>,</span>
<span>  outcome_cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"catvarA"</span>, <span class="st">"catvarB"</span>, <span class="st">"catvarC"</span>, <span class="st">"nvarA"</span>, <span class="st">"nvarB"</span>, <span class="st">"nvarC"</span><span class="op">)</span>,</span>
<span>  model_var <span class="op">=</span> <span class="st">"assigned_treatment"</span>,</span>
<span>  use_weight <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  use_censor <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  glm_function <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>  use_sample_weights <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in eval(family$initialize): non-integer #successes in a binomial glm!</span></span>
<span><span class="co">#&gt; [1] "Base Analysis"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; stats::glm(formula = model_formula, family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = data, weights = data[, weight])</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -1.3846  -0.2879  -0.2115  -0.1359   9.9851  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                      Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)        -2.114e+00  2.403e-01  -8.800  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; assigned_treatment -5.881e-01  5.836e-02 -10.078  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; for_period         -1.446e-03  9.114e-04  -1.587  0.11261    </span></span>
<span><span class="co">#&gt; I(for_period^2)     8.148e-06  2.000e-06   4.075 4.61e-05 ***</span></span>
<span><span class="co">#&gt; followup_time       1.655e-03  1.014e-03   1.633  0.10254    </span></span>
<span><span class="co">#&gt; I(followup_time^2) -1.889e-05  6.116e-06  -3.088  0.00201 ** </span></span>
<span><span class="co">#&gt; catvarA1            5.038e-01  3.917e-02  12.862  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; catvarA2            4.404e-01  5.499e-02   8.008 1.17e-15 ***</span></span>
<span><span class="co">#&gt; catvarA3           -9.931e+00  5.023e+01  -0.198  0.84328    </span></span>
<span><span class="co">#&gt; catvarA7            4.503e-01  7.212e-02   6.243 4.29e-10 ***</span></span>
<span><span class="co">#&gt; catvarB1           -4.941e-01  1.942e-01  -2.544  0.01096 *  </span></span>
<span><span class="co">#&gt; catvarB2           -1.450e-01  1.972e-01  -0.736  0.46195    </span></span>
<span><span class="co">#&gt; catvarB3           -2.515e+00  3.708e-01  -6.781 1.19e-11 ***</span></span>
<span><span class="co">#&gt; catvarB7           -8.504e-01  1.965e-01  -4.328 1.51e-05 ***</span></span>
<span><span class="co">#&gt; catvarC1           -8.485e-02  4.901e-02  -1.731  0.08343 .  </span></span>
<span><span class="co">#&gt; catvarC2            8.743e-02  4.318e-02   2.025  0.04291 *  </span></span>
<span><span class="co">#&gt; catvarC7           -5.227e-01  6.315e-02  -8.277  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; nvarA              -1.671e-02  8.905e-03  -1.876  0.06066 .  </span></span>
<span><span class="co">#&gt; nvarB               3.050e-03  3.966e-04   7.690 1.47e-14 ***</span></span>
<span><span class="co">#&gt; nvarC              -5.553e-02  1.247e-03 -44.526  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 57198  on 132340  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 53761  on 132321  degrees of freedom</span></span>
<span><span class="co">#&gt;   (8 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; AIC: 53661</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "-------------------------------------------------"</span></span>
<span><span class="co">#&gt; [1] "Processing time of modeling for base analysis:"</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   1.649   0.200   1.850 </span></span>
<span><span class="co">#&gt; [1] "Base Analysis with robust variance"</span></span>
<span><span class="co">#&gt; [1] "-------------------------------------------------------"</span></span>
<span><span class="co">#&gt; [1] "Robust standard error:"</span></span>
<span><span class="co">#&gt; $summary</span></span>
<span><span class="co">#&gt;                  names      estimate    robust_se            lb            ub</span></span>
<span><span class="co">#&gt;  1:        (Intercept) -2.114344e+00 1.126152e+00 -4.321602e+00  9.291379e-02</span></span>
<span><span class="co">#&gt;  2: assigned_treatment -5.880942e-01 4.898653e-01 -1.548230e+00  3.720419e-01</span></span>
<span><span class="co">#&gt;  3:         for_period -1.446014e-03 5.599681e-03 -1.242139e-02  9.529362e-03</span></span>
<span><span class="co">#&gt;  4:    I(for_period^2)  8.147987e-06 1.221441e-05 -1.579226e-05  3.208823e-05</span></span>
<span><span class="co">#&gt;  5:      followup_time  1.654926e-03 5.860386e-03 -9.831431e-03  1.314128e-02</span></span>
<span><span class="co">#&gt;  6: I(followup_time^2) -1.888736e-05 5.453110e-05 -1.257683e-04  8.799360e-05</span></span>
<span><span class="co">#&gt;  7:           catvarA1  5.038452e-01 3.143022e-01 -1.121870e-01  1.119877e+00</span></span>
<span><span class="co">#&gt;  8:           catvarA2  4.403870e-01 3.751537e-01 -2.949141e-01  1.175688e+00</span></span>
<span><span class="co">#&gt;  9:           catvarA3 -9.931160e+00 7.997415e-01 -1.149865e+01 -8.363667e+00</span></span>
<span><span class="co">#&gt; 10:           catvarA7  4.502763e-01 3.992065e-01 -3.321683e-01  1.232721e+00</span></span>
<span><span class="co">#&gt; 11:           catvarB1 -4.940554e-01 7.016684e-01 -1.869325e+00  8.812147e-01</span></span>
<span><span class="co">#&gt; 12:           catvarB2 -1.450426e-01 7.363093e-01 -1.588209e+00  1.298124e+00</span></span>
<span><span class="co">#&gt; 13:           catvarB3 -2.514752e+00 1.152175e+00 -4.773015e+00 -2.564880e-01</span></span>
<span><span class="co">#&gt; 14:           catvarB7 -8.504199e-01 7.264634e-01 -2.274288e+00  5.734483e-01</span></span>
<span><span class="co">#&gt; 15:           catvarC1 -8.484730e-02 2.333827e-01 -5.422774e-01  3.725828e-01</span></span>
<span><span class="co">#&gt; 16:           catvarC2  8.742936e-02 2.982113e-01 -4.970648e-01  6.719235e-01</span></span>
<span><span class="co">#&gt; 17:           catvarC7 -5.227326e-01 3.578359e-01 -1.224091e+00  1.786259e-01</span></span>
<span><span class="co">#&gt; 18:              nvarA -1.670583e-02 5.649195e-02 -1.274301e-01  9.401839e-02</span></span>
<span><span class="co">#&gt; 19:              nvarB  3.049991e-03 2.434324e-03 -1.721284e-03  7.821266e-03</span></span>
<span><span class="co">#&gt; 20:              nvarC -5.553021e-02 1.009713e-02 -7.532059e-02 -3.573983e-02</span></span>
<span><span class="co">#&gt;               z  p_value</span></span>
<span><span class="co">#&gt;  1:  -1.8774945 0.060450</span></span>
<span><span class="co">#&gt;  2:  -1.2005221 0.229937</span></span>
<span><span class="co">#&gt;  3:  -0.2582314 0.796228</span></span>
<span><span class="co">#&gt;  4:   0.6670799 0.504721</span></span>
<span><span class="co">#&gt;  5:   0.2823919 0.777643</span></span>
<span><span class="co">#&gt;  6:  -0.3463594 0.729073</span></span>
<span><span class="co">#&gt;  7:   1.6030600 0.108921</span></span>
<span><span class="co">#&gt;  8:   1.1738844 0.240441</span></span>
<span><span class="co">#&gt;  9: -12.4179634  &lt; 0.001</span></span>
<span><span class="co">#&gt; 10:   1.1279284 0.259350</span></span>
<span><span class="co">#&gt; 11:  -0.7041152 0.481361</span></span>
<span><span class="co">#&gt; 12:  -0.1969860 0.843839</span></span>
<span><span class="co">#&gt; 13:  -2.1826120 0.029064</span></span>
<span><span class="co">#&gt; 14:  -1.1706302 0.241747</span></span>
<span><span class="co">#&gt; 15:  -0.3635544 0.716191</span></span>
<span><span class="co">#&gt; 16:   0.2931792 0.769385</span></span>
<span><span class="co">#&gt; 17:  -1.4608163 0.144066</span></span>
<span><span class="co">#&gt; 18:  -0.2957206 0.767443</span></span>
<span><span class="co">#&gt; 19:   1.2529107 0.210238</span></span>
<span><span class="co">#&gt; 20:  -5.4996021  &lt; 0.001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $matrix</span></span>
<span><span class="co">#&gt;                      (Intercept) assigned_treatment    for_period</span></span>
<span><span class="co">#&gt; (Intercept)         1.268219e+00       1.107078e-02 -3.150730e-03</span></span>
<span><span class="co">#&gt; assigned_treatment  1.107078e-02       2.399681e-01 -9.209727e-05</span></span>
<span><span class="co">#&gt; for_period         -3.150730e-03      -9.209727e-05  3.135643e-05</span></span>
<span><span class="co">#&gt; I(for_period^2)     4.298025e-06      -3.371577e-07 -6.329668e-08</span></span>
<span><span class="co">#&gt; followup_time      -3.225824e-04      -2.889151e-04 -7.073875e-06</span></span>
<span><span class="co">#&gt; I(followup_time^2) -2.524974e-06      -2.628053e-06  8.498418e-08</span></span>
<span><span class="co">#&gt; catvarA1           -4.987746e-02       1.136643e-02  1.826005e-04</span></span>
<span><span class="co">#&gt; catvarA2           -5.467038e-02       3.835394e-02  9.971852e-05</span></span>
<span><span class="co">#&gt; catvarA3           -2.060644e-02       1.774842e-02 -7.882922e-05</span></span>
<span><span class="co">#&gt; catvarA7           -9.089881e-02       2.374609e-02  3.890407e-04</span></span>
<span><span class="co">#&gt; catvarB1           -4.948868e-01      -9.591227e-03  4.656524e-05</span></span>
<span><span class="co">#&gt; catvarB2           -4.615571e-01      -1.635220e-02 -6.629113e-05</span></span>
<span><span class="co">#&gt; catvarB3           -5.423949e-01       1.351274e-02  7.181782e-06</span></span>
<span><span class="co">#&gt; catvarB7           -5.755907e-01      -1.618280e-02  1.414417e-04</span></span>
<span><span class="co">#&gt; catvarC1            2.558063e-02      -7.492578e-03  2.113515e-05</span></span>
<span><span class="co">#&gt; catvarC2            2.433801e-03      -2.265502e-02  3.987541e-04</span></span>
<span><span class="co">#&gt; catvarC7           -7.474562e-02       2.875366e-05  5.435119e-04</span></span>
<span><span class="co">#&gt; nvarA              -1.991757e-03      -2.673264e-03 -2.885824e-05</span></span>
<span><span class="co">#&gt; nvarB               1.085164e-04       4.260660e-05 -3.867576e-07</span></span>
<span><span class="co">#&gt; nvarC              -4.043848e-03       5.259699e-04 -8.154964e-06</span></span>
<span><span class="co">#&gt;                    I(for_period^2) followup_time I(followup_time^2)</span></span>
<span><span class="co">#&gt; (Intercept)           4.298025e-06 -3.225824e-04      -2.524974e-06</span></span>
<span><span class="co">#&gt; assigned_treatment   -3.371577e-07 -2.889151e-04      -2.628053e-06</span></span>
<span><span class="co">#&gt; for_period           -6.329668e-08 -7.073875e-06       8.498418e-08</span></span>
<span><span class="co">#&gt; I(for_period^2)       1.491918e-10  2.469750e-08      -2.110912e-10</span></span>
<span><span class="co">#&gt; followup_time         2.469750e-08  3.434412e-05      -2.603198e-07</span></span>
<span><span class="co">#&gt; I(followup_time^2)   -2.110912e-10 -2.603198e-07       2.973641e-09</span></span>
<span><span class="co">#&gt; catvarA1             -3.261194e-07 -7.178297e-04       9.207576e-06</span></span>
<span><span class="co">#&gt; catvarA2             -1.319788e-07 -9.356686e-05       7.520065e-07</span></span>
<span><span class="co">#&gt; catvarA3              2.428787e-07 -2.534038e-04       5.462634e-06</span></span>
<span><span class="co">#&gt; catvarA7             -5.487445e-07 -1.022854e-04       2.007468e-07</span></span>
<span><span class="co">#&gt; catvarB1              2.357781e-07  1.808454e-04       2.058129e-06</span></span>
<span><span class="co">#&gt; catvarB2              4.313608e-07  1.634678e-04       2.969772e-06</span></span>
<span><span class="co">#&gt; catvarB3              5.090514e-07 -1.324279e-04       2.519342e-06</span></span>
<span><span class="co">#&gt; catvarB7              6.142174e-07  3.026176e-04       1.032279e-06</span></span>
<span><span class="co">#&gt; catvarC1             -1.938390e-07 -5.235865e-04       4.655876e-06</span></span>
<span><span class="co">#&gt; catvarC2             -8.057326e-07 -5.613989e-04       7.831786e-06</span></span>
<span><span class="co">#&gt; catvarC7             -9.126840e-07  1.979800e-04      -2.536777e-06</span></span>
<span><span class="co">#&gt; nvarA                 7.440372e-08 -3.104818e-06      -1.376799e-07</span></span>
<span><span class="co">#&gt; nvarB                -2.322294e-09 -3.453892e-07      -8.287150e-09</span></span>
<span><span class="co">#&gt; nvarC                 1.711408e-08  5.180627e-06      -1.502573e-07</span></span>
<span><span class="co">#&gt;                         catvarA1      catvarA2      catvarA3      catvarA7</span></span>
<span><span class="co">#&gt; (Intercept)        -4.987746e-02 -5.467038e-02 -2.060644e-02 -9.089881e-02</span></span>
<span><span class="co">#&gt; assigned_treatment  1.136643e-02  3.835394e-02  1.774842e-02  2.374609e-02</span></span>
<span><span class="co">#&gt; for_period          1.826005e-04  9.971852e-05 -7.882922e-05  3.890407e-04</span></span>
<span><span class="co">#&gt; I(for_period^2)    -3.261194e-07 -1.319788e-07  2.428787e-07 -5.487445e-07</span></span>
<span><span class="co">#&gt; followup_time      -7.178297e-04 -9.356686e-05 -2.534038e-04 -1.022854e-04</span></span>
<span><span class="co">#&gt; I(followup_time^2)  9.207576e-06  7.520065e-07  5.462634e-06  2.007468e-07</span></span>
<span><span class="co">#&gt; catvarA1            9.878584e-02  5.839042e-02  6.211709e-02  3.443353e-02</span></span>
<span><span class="co">#&gt; catvarA2            5.839042e-02  1.407403e-01  6.290002e-02  6.049146e-02</span></span>
<span><span class="co">#&gt; catvarA3            6.211709e-02  6.290002e-02  6.395864e-01  5.789218e-02</span></span>
<span><span class="co">#&gt; catvarA7            3.443353e-02  6.049146e-02  5.789218e-02  1.593658e-01</span></span>
<span><span class="co">#&gt; catvarB1            2.346528e-02  7.423667e-03  1.473228e-02  4.681017e-04</span></span>
<span><span class="co">#&gt; catvarB2            2.764835e-02  5.674852e-03  1.870426e-02  4.474092e-03</span></span>
<span><span class="co">#&gt; catvarB3            3.612704e-02  4.670971e-02  5.120563e-03  7.294970e-03</span></span>
<span><span class="co">#&gt; catvarB7            2.338491e-02  3.374648e-03  1.170377e-02  5.918562e-03</span></span>
<span><span class="co">#&gt; catvarC1            1.489738e-02  8.475987e-03  1.876228e-02  3.694728e-03</span></span>
<span><span class="co">#&gt; catvarC2            1.367703e-02  1.455380e-03  1.779105e-02  1.252341e-02</span></span>
<span><span class="co">#&gt; catvarC7           -1.351735e-03 -2.512167e-03 -4.361826e-02 -3.191286e-02</span></span>
<span><span class="co">#&gt; nvarA              -1.113474e-03 -5.375911e-05 -1.956562e-03 -2.833334e-04</span></span>
<span><span class="co">#&gt; nvarB               4.012989e-05  7.642305e-05  5.375398e-05  2.208640e-06</span></span>
<span><span class="co">#&gt; nvarC              -8.604563e-04 -3.402761e-04 -7.107440e-04 -1.078775e-04</span></span>
<span><span class="co">#&gt;                         catvarB1      catvarB2      catvarB3      catvarB7</span></span>
<span><span class="co">#&gt; (Intercept)        -4.948868e-01 -4.615571e-01 -5.423949e-01 -5.755907e-01</span></span>
<span><span class="co">#&gt; assigned_treatment -9.591227e-03 -1.635220e-02  1.351274e-02 -1.618280e-02</span></span>
<span><span class="co">#&gt; for_period          4.656524e-05 -6.629113e-05  7.181782e-06  1.414417e-04</span></span>
<span><span class="co">#&gt; I(for_period^2)     2.357781e-07  4.313608e-07  5.090514e-07  6.142174e-07</span></span>
<span><span class="co">#&gt; followup_time       1.808454e-04  1.634678e-04 -1.324279e-04  3.026176e-04</span></span>
<span><span class="co">#&gt; I(followup_time^2)  2.058129e-06  2.969772e-06  2.519342e-06  1.032279e-06</span></span>
<span><span class="co">#&gt; catvarA1            2.346528e-02  2.764835e-02  3.612704e-02  2.338491e-02</span></span>
<span><span class="co">#&gt; catvarA2            7.423667e-03  5.674852e-03  4.670971e-02  3.374648e-03</span></span>
<span><span class="co">#&gt; catvarA3            1.473228e-02  1.870426e-02  5.120563e-03  1.170377e-02</span></span>
<span><span class="co">#&gt; catvarA7            4.681017e-04  4.474092e-03  7.294970e-03  5.918562e-03</span></span>
<span><span class="co">#&gt; catvarB1            4.923385e-01  4.690072e-01  4.715563e-01  4.793080e-01</span></span>
<span><span class="co">#&gt; catvarB2            4.690072e-01  5.421514e-01  5.181616e-01  4.769291e-01</span></span>
<span><span class="co">#&gt; catvarB3            4.715563e-01  5.181616e-01  1.327508e+00  5.070073e-01</span></span>
<span><span class="co">#&gt; catvarB7            4.793080e-01  4.769291e-01  5.070073e-01  5.277490e-01</span></span>
<span><span class="co">#&gt; catvarC1           -5.673020e-03  9.432525e-04 -8.214730e-03 -1.710528e-02</span></span>
<span><span class="co">#&gt; catvarC2           -1.765587e-03  1.411812e-02 -1.570593e-02 -1.208375e-02</span></span>
<span><span class="co">#&gt; catvarC7           -9.088446e-03 -1.118460e-02 -9.655758e-03 -1.719444e-02</span></span>
<span><span class="co">#&gt; nvarA               1.517474e-03  2.639870e-03  6.270807e-04  1.893061e-03</span></span>
<span><span class="co">#&gt; nvarB              -3.062791e-04 -2.501956e-04 -1.472970e-04 -3.048548e-04</span></span>
<span><span class="co">#&gt; nvarC              -1.433374e-04 -7.577457e-04  1.316509e-04  2.198136e-04</span></span>
<span><span class="co">#&gt;                         catvarC1      catvarC2      catvarC7         nvarA</span></span>
<span><span class="co">#&gt; (Intercept)         2.558063e-02  2.433801e-03 -7.474562e-02 -1.991757e-03</span></span>
<span><span class="co">#&gt; assigned_treatment -7.492578e-03 -2.265502e-02  2.875366e-05 -2.673264e-03</span></span>
<span><span class="co">#&gt; for_period          2.113515e-05  3.987541e-04  5.435119e-04 -2.885824e-05</span></span>
<span><span class="co">#&gt; I(for_period^2)    -1.938390e-07 -8.057326e-07 -9.126840e-07  7.440372e-08</span></span>
<span><span class="co">#&gt; followup_time      -5.235865e-04 -5.613989e-04  1.979800e-04 -3.104818e-06</span></span>
<span><span class="co">#&gt; I(followup_time^2)  4.655876e-06  7.831786e-06 -2.536777e-06 -1.376799e-07</span></span>
<span><span class="co">#&gt; catvarA1            1.489738e-02  1.367703e-02 -1.351735e-03 -1.113474e-03</span></span>
<span><span class="co">#&gt; catvarA2            8.475987e-03  1.455380e-03 -2.512167e-03 -5.375911e-05</span></span>
<span><span class="co">#&gt; catvarA3            1.876228e-02  1.779105e-02 -4.361826e-02 -1.956562e-03</span></span>
<span><span class="co">#&gt; catvarA7            3.694728e-03  1.252341e-02 -3.191286e-02 -2.833334e-04</span></span>
<span><span class="co">#&gt; catvarB1           -5.673020e-03 -1.765587e-03 -9.088446e-03  1.517474e-03</span></span>
<span><span class="co">#&gt; catvarB2            9.432525e-04  1.411812e-02 -1.118460e-02  2.639870e-03</span></span>
<span><span class="co">#&gt; catvarB3           -8.214730e-03 -1.570593e-02 -9.655758e-03  6.270807e-04</span></span>
<span><span class="co">#&gt; catvarB7           -1.710528e-02 -1.208375e-02 -1.719444e-02  1.893061e-03</span></span>
<span><span class="co">#&gt; catvarC1            5.446748e-02  3.661084e-02  1.221986e-02  2.020477e-04</span></span>
<span><span class="co">#&gt; catvarC2            3.661084e-02  8.892999e-02  1.350877e-02  9.390965e-04</span></span>
<span><span class="co">#&gt; catvarC7            1.221986e-02  1.350877e-02  1.280466e-01 -8.043976e-04</span></span>
<span><span class="co">#&gt; nvarA               2.020477e-04  9.390965e-04 -8.043976e-04  3.191340e-03</span></span>
<span><span class="co">#&gt; nvarB               3.653059e-05 -1.528687e-05  1.644258e-04 -4.178135e-05</span></span>
<span><span class="co">#&gt; nvarC              -5.439418e-04 -1.227427e-03 -2.433143e-04  5.282397e-05</span></span>
<span><span class="co">#&gt;                            nvarB         nvarC</span></span>
<span><span class="co">#&gt; (Intercept)         1.085164e-04 -4.043848e-03</span></span>
<span><span class="co">#&gt; assigned_treatment  4.260660e-05  5.259699e-04</span></span>
<span><span class="co">#&gt; for_period         -3.867576e-07 -8.154964e-06</span></span>
<span><span class="co">#&gt; I(for_period^2)    -2.322294e-09  1.711408e-08</span></span>
<span><span class="co">#&gt; followup_time      -3.453892e-07  5.180627e-06</span></span>
<span><span class="co">#&gt; I(followup_time^2) -8.287150e-09 -1.502573e-07</span></span>
<span><span class="co">#&gt; catvarA1            4.012989e-05 -8.604563e-04</span></span>
<span><span class="co">#&gt; catvarA2            7.642305e-05 -3.402761e-04</span></span>
<span><span class="co">#&gt; catvarA3            5.375398e-05 -7.107440e-04</span></span>
<span><span class="co">#&gt; catvarA7            2.208640e-06 -1.078775e-04</span></span>
<span><span class="co">#&gt; catvarB1           -3.062791e-04 -1.433374e-04</span></span>
<span><span class="co">#&gt; catvarB2           -2.501956e-04 -7.577457e-04</span></span>
<span><span class="co">#&gt; catvarB3           -1.472970e-04  1.316509e-04</span></span>
<span><span class="co">#&gt; catvarB7           -3.048548e-04  2.198136e-04</span></span>
<span><span class="co">#&gt; catvarC1            3.653059e-05 -5.439418e-04</span></span>
<span><span class="co">#&gt; catvarC2           -1.528687e-05 -1.227427e-03</span></span>
<span><span class="co">#&gt; catvarC7            1.644258e-04 -2.433143e-04</span></span>
<span><span class="co">#&gt; nvarA              -4.178135e-05  5.282397e-05</span></span>
<span><span class="co">#&gt; nvarB               5.925934e-06  2.616434e-06</span></span>
<span><span class="co">#&gt; nvarC               2.616434e-06  1.019521e-04</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "----------------------------------------------"</span></span>
<span><span class="co">#&gt; [1] "Processing time of getting the output and sandwich with reduced switch data:"</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.153   0.000   0.153</span></span></code></pre></div>
<p>The result is the same type as the previous result from the simple <code>initiators</code> function, containing the <code>glm</code> object and the sandwich results.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">model_result</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ model :List of 31</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:2] "glm" "lm"</span></span>
<span><span class="co">#&gt;  $ robust:List of 2</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_result</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; stats::glm(formula = model_formula, family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = data, weights = data[, weight])</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -1.3846  -0.2879  -0.2115  -0.1359   9.9851  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                      Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)        -2.114e+00  2.403e-01  -8.800  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; assigned_treatment -5.881e-01  5.836e-02 -10.078  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; for_period         -1.446e-03  9.114e-04  -1.587  0.11261    </span></span>
<span><span class="co">#&gt; I(for_period^2)     8.148e-06  2.000e-06   4.075 4.61e-05 ***</span></span>
<span><span class="co">#&gt; followup_time       1.655e-03  1.014e-03   1.633  0.10254    </span></span>
<span><span class="co">#&gt; I(followup_time^2) -1.889e-05  6.116e-06  -3.088  0.00201 ** </span></span>
<span><span class="co">#&gt; catvarA1            5.038e-01  3.917e-02  12.862  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; catvarA2            4.404e-01  5.499e-02   8.008 1.17e-15 ***</span></span>
<span><span class="co">#&gt; catvarA3           -9.931e+00  5.023e+01  -0.198  0.84328    </span></span>
<span><span class="co">#&gt; catvarA7            4.503e-01  7.212e-02   6.243 4.29e-10 ***</span></span>
<span><span class="co">#&gt; catvarB1           -4.941e-01  1.942e-01  -2.544  0.01096 *  </span></span>
<span><span class="co">#&gt; catvarB2           -1.450e-01  1.972e-01  -0.736  0.46195    </span></span>
<span><span class="co">#&gt; catvarB3           -2.515e+00  3.708e-01  -6.781 1.19e-11 ***</span></span>
<span><span class="co">#&gt; catvarB7           -8.504e-01  1.965e-01  -4.328 1.51e-05 ***</span></span>
<span><span class="co">#&gt; catvarC1           -8.485e-02  4.901e-02  -1.731  0.08343 .  </span></span>
<span><span class="co">#&gt; catvarC2            8.743e-02  4.318e-02   2.025  0.04291 *  </span></span>
<span><span class="co">#&gt; catvarC7           -5.227e-01  6.315e-02  -8.277  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; nvarA              -1.671e-02  8.905e-03  -1.876  0.06066 .  </span></span>
<span><span class="co">#&gt; nvarB               3.050e-03  3.966e-04   7.690 1.47e-14 ***</span></span>
<span><span class="co">#&gt; nvarC              -5.553e-02  1.247e-03 -44.526  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 57198  on 132340  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 53761  on 132321  degrees of freedom</span></span>
<span><span class="co">#&gt;   (8 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; AIC: 53661</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 13</span></span></code></pre></div>
<p>We can also use this object to predict cumulative incidence curves and use these for treatment comparisons. Here we use the patients who were in the first trial as the target population. To get the data in the right format, we can use the <code>data_template</code> returned by <code><a href="../reference/data_preparation.html">data_preparation()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_data</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working_dir</span>, <span class="st">"trial_1.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">new_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">prep_data</span><span class="op">$</span><span class="va">data_template</span><span class="op">)</span>, <span class="va">new_data</span><span class="op">)</span></span>
<span><span class="va">model_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_survival.html">predict_survival</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">model_result</span><span class="op">$</span><span class="va">model</span>, predict_times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">40</span><span class="op">)</span>, newdata <span class="op">=</span> <span class="va">new_data</span><span class="op">)</span></span></code></pre></div>
<p>We can easily compare the curves visually.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_preds</span><span class="op">$</span><span class="va">trt_0</span>, ty <span class="op">=</span> <span class="st">"l"</span>, ylab <span class="op">=</span> <span class="st">"Cumulative Incidence"</span>, xlab <span class="op">=</span> <span class="st">"Follow-up Time"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">model_preds</span><span class="op">$</span><span class="va">trt_1</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Getting-Started_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_preds</span><span class="op">$</span><span class="va">trt_1</span> <span class="op">-</span> <span class="va">model_preds</span><span class="op">$</span><span class="va">trt_0</span>, ty <span class="op">=</span> <span class="st">"l"</span>, ylab <span class="op">=</span> <span class="st">"Cumulative Incidence Difference"</span>, xlab <span class="op">=</span> <span class="st">"Follow-up Time"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Getting-Started_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Roonak Rezvani, Isaac Gravestock, Li Su.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
