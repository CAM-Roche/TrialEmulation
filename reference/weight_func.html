<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Weight Calculation Function — weight_func • TrialEmulation</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Weight Calculation Function — weight_func"><meta property="og:description" content="This function performs the calculation for weight of the data"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TrialEmulation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.3.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Getting-Started.html">Getting-Started</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/Causal-LDA/TrialEmulation/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Weight Calculation Function</h1>
    <small class="dont-index">Source: <a href="https://github.com/Causal-LDA/TrialEmulation/blob/HEAD/R/data_utils.R" class="external-link"><code>R/data_utils.R</code></a></small>
    <div class="hidden name"><code>weight_func.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function performs the calculation for weight of the data</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">weight_func</span><span class="op">(</span></span>
<span>  <span class="va">sw_data</span>,</span>
<span>  use_switch_weights <span class="op">=</span> <span class="va">use_switch_weights</span>,</span>
<span>  use_censor_weights <span class="op">=</span> <span class="va">use_censor_weights</span>,</span>
<span>  switch_n_cov <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  switch_d_cov <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  eligible_wts_0 <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  eligible_wts_1 <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  cense <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  pool_cense_n <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  pool_cense_d <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cense_d_cov <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  cense_n_cov <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  save_weight_models <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">data_dir</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  glm_function <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>sw_data</dt>
<dd><p>A data.table</p></dd>


<dt>use_censor_weights</dt>
<dd><p>Require the inverse probability of censoring weights. If <code>use_censor_weights = TRUE</code>, then
the variable name of the censoring indicator needs to be provided in the argument <code>cense</code>.</p></dd>


<dt>switch_n_cov</dt>
<dd><p>A RHS formula to specify the logistic models for estimating the numerator terms of the inverse
probability of treatment weights. A derived variable named <code>time_on_regime</code> containing the duration of time that
the individual has been on the current treatment/non-treatment is available for use in these models.</p></dd>


<dt>switch_d_cov</dt>
<dd><p>A RHS formula to specify the logistic models for estimating the denominator terms of the inverse
probability of treatment weights.</p></dd>


<dt>eligible_wts_0</dt>
<dd><p>See definition for <code>eligible_wts_1</code></p></dd>


<dt>eligible_wts_1</dt>
<dd><p>Exclude some observations when fitting the models for the inverse probability of treatment
weights. For example, if it is assumed that an individual will stay on treatment for at least 2 visits, the first 2
visits  after treatment initiation by definition have a probability of staying on the treatment of 1.0 and should
thus be excluded from the weight models for those who are on treatment at the immediately previous visit. Users can
define a variable that indicates that these 2 observations are ineligible for the weight model for those who are on
treatment at the immediately previous visit and add the variable name in the argument <code>eligible_wts_1</code>. Similar
definitions are applied to <code>eligible_wts_0</code> for excluding observations when fitting the models for the inverse
probability of treatment weights for those who are not on treatment at the immediately previous visit.</p></dd>


<dt>cense</dt>
<dd><p>Variable name for the censoring indicator. Required if <code>use_censor_weights = TRUE</code>.</p></dd>


<dt>cense_d_cov</dt>
<dd><p>A RHS formula to specify the logistic models for estimating the denominator terms of the inverse
probability of censoring weights.</p></dd>


<dt>cense_n_cov</dt>
<dd><p>A RHS formula to specify the logistic models for estimating the numerator terms of the inverse
probability of censoring weights.</p></dd>


<dt>save_weight_models</dt>
<dd><p>Save model objects for estimating the weights in <code>data_dir</code>.</p></dd>


<dt>data_dir</dt>
<dd><p>Directory to save model objects in.</p></dd>


<dt>quiet</dt>
<dd><p>Suppress the printing of progress messages and summaries of the fitted models.</p></dd>


<dt>glm_function</dt>
<dd><p>Specify which glm function to use for the marginal structural model from the <code>stats</code> or <code>parglm</code>
packages. The default function is the <code>glm</code> function in the <code>stats</code> package. Users can also specify <code>glm_function = "parglm"</code> such that the <code>parglm</code> function in the <code>parglm</code> package can be used for fitting generalized linear models
in parallel. The default control setting for  <code>parglm</code> is <code>nthreads = 4</code> and <code>method = "FAST"</code>, where four cores
and Fisher information are used for faster computation. Users can change the default control setting by passing the
arguments <code>nthreads</code> and <code>method</code> in the <code>parglm.control</code> function of the <code>parglm</code> package, or alternatively, by
passing a <code>control</code> argument with a list produced by <code>parglm.control(nthreads = , method = )</code>.</p></dd>


<dt>...</dt>
<dd><p>Additional arguments passed to <code>glm_function</code>. This may be used to specify initial values of parameters or
arguments to <code>control</code>. See <a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm</a>, <a href="https://rdrr.io/pkg/parglm/man/parglm.html" class="external-link">parglm::parglm</a> and <code><a href="https://rdrr.io/pkg/parglm/man/parglm.control.html" class="external-link">parglm::parglm.control()</a></code> for more information.</p></dd>


<dt>save_dir</dt>
<dd><p>Directory to save tidy weight model summaries in as 'weight_models.rda'</p></dd>

</dl></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Roonak Rezvani, Isaac Gravestock, Li Su, Medical Research Council (MRC), F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

